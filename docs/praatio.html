<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 8.0.1" />
    <title>praatio API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{display:none;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{--shift:-40px;text-align:right;margin-top:var(--shift);margin-bottom:calc(0px - var(--shift));clear:both;filter:opacity(1);}.pdoc details:not([open]){height:0;overflow:visible;}.pdoc details > summary{font-size:.75rem;cursor:pointer;color:var(--muted);border-width:0;padding:0 .7em;display:inline-block;display:inline list-item;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc details > div{margin-top:calc(0px - var(--shift) / 2);text-align:left;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:3rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:1rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox">
            <div>
                        <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;
                            Module Index
                        </a>


                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>


                    <h2>Submodules</h2>
                    <ul>
                            <li><a href="praatio/audio.html">praatio.audio</a></li>
                            <li><a href="praatio/data_points.html">praatio.data_points</a></li>
                            <li><a href="praatio/klattgrid.html">praatio.klattgrid</a></li>
                            <li><a href="praatio/pitch_and_intensity.html">praatio.pitch_and_intensity</a></li>
                            <li><a href="praatio/praat_scripts.html">praatio.praat_scripts</a></li>
                            <li><a href="praatio/praatio_scripts.html">praatio.praatio_scripts</a></li>
                            <li><a href="praatio/textgrid.html">praatio.textgrid</a></li>
                            <li><a href="praatio/data_classes.html">praatio.data_classes</a></li>
                            <li><a href="praatio/utilities.html">praatio.utilities</a></li>
                    </ul>

                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="module" href="#audio">audio</a>
            </li>
            <li>
                    <a class="module" href="#data_points">data_points</a>
            </li>
            <li>
                    <a class="module" href="#klattgrid">klattgrid</a>
            </li>
            <li>
                    <a class="module" href="#pitch_and_intensity">pitch_and_intensity</a>
            </li>
            <li>
                    <a class="module" href="#praat_scripts">praat_scripts</a>
            </li>
            <li>
                    <a class="module" href="#praatio_scripts">praatio_scripts</a>
            </li>
            <li>
                    <a class="module" href="#textgrid">textgrid</a>
            </li>
            <li>
                    <a class="module" href="#data_classes">data_classes</a>
            </li>
            <li>
                    <a class="module" href="#utilities">utilities</a>
            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
praatio    </h1>

                        <div class="docstring"><p>Praatio is a library for working praat files and audio data.</p>

<p>Praat is a popular tool for working with transcribed speech data.
It has tools for annotating speech, manipulating speech, and extracting
information from speech.
Praat's homepage: <a href="http://www.fon.hum.uva.nl/praat/">http://www.fon.hum.uva.nl/praat/</a></p>

<p>praatio's utility comes from the classes Textgrid, IntervalTier,
and PointTier in <strong>textgrid.py</strong> These classes represent the speech transcript
data stored inside of .TextGrid files.  textgrid.py contains functions for
reading/writing these objects from/to files. <strong>data_points.py</strong> and <strong>klattgrid.py</strong>
contain similar code for other data files that praat works with.</p>

<p><strong>pitch_and_intensity.py</strong> uses praat to extract pitch and intensity values
from audio using praat.</p>

<p><strong>praat_scripts.py</strong> enables one to run various praat scripts from within python.
If preferred, one can access the <strong>praatScripts/</strong> directory to view and edit the
praat scripts or open them directly in praat. They can all be run independentlyof python.</p>

<p><strong>audio.py</strong> is for reading, reading, and performing simple manipulations to wave files.</p>

<p><strong>praatio_scripts.py</strong> contains code that combines various code in praatio--mostly
high-level functions for working with textgrids, sometimes in conjuction with audio files.</p>

<p>For example scripts that use various parts of the praatio library, please see 'examples/'
in the root directory. If you downloaded praatio from pip, you can get the example files
on the praatio github page:
<a href="https://github.com/timmahrt/praatIO">https://github.com/timmahrt/praatIO</a></p>

<p>There is also a tutorial for working with praatio on the github page.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Praatio is a library for working praat files and audio data.</span>

<span class="sd">Praat is a popular tool for working with transcribed speech data.</span>
<span class="sd">It has tools for annotating speech, manipulating speech, and extracting</span>
<span class="sd">information from speech.</span>
<span class="sd">Praat&#39;s homepage: [http://www.fon.hum.uva.nl/praat/](http://www.fon.hum.uva.nl/praat/)</span>

<span class="sd">praatio&#39;s utility comes from the classes Textgrid, IntervalTier,</span>
<span class="sd">and PointTier in **textgrid.py** These classes represent the speech transcript</span>
<span class="sd">data stored inside of .TextGrid files.  textgrid.py contains functions for</span>
<span class="sd">reading/writing these objects from/to files. **data_points.py** and **klattgrid.py**</span>
<span class="sd">contain similar code for other data files that praat works with.</span>

<span class="sd">**pitch_and_intensity.py** uses praat to extract pitch and intensity values</span>
<span class="sd">from audio using praat.</span>

<span class="sd">**praat_scripts.py** enables one to run various praat scripts from within python.</span>
<span class="sd">If preferred, one can access the **praatScripts/** directory to view and edit the</span>
<span class="sd">praat scripts or open them directly in praat. They can all be run independentlyof python.</span>

<span class="sd">**audio.py** is for reading, reading, and performing simple manipulations to wave files.</span>

<span class="sd">**praatio_scripts.py** contains code that combines various code in praatio--mostly</span>
<span class="sd">high-level functions for working with textgrids, sometimes in conjuction with audio files.</span>

<span class="sd">For example scripts that use various parts of the praatio library, please see &#39;examples/&#39;</span>
<span class="sd">in the root directory. If you downloaded praatio from pip, you can get the example files</span>
<span class="sd">on the praatio github page:</span>
<span class="sd">[https://github.com/timmahrt/praatIO](https://github.com/timmahrt/praatIO)</span>

<span class="sd">There is also a tutorial for working with praatio on the github page.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;audio&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data_points&quot;</span><span class="p">,</span>
    <span class="s2">&quot;klattgrid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pitch_and_intensity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;praat_scripts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;praatio_scripts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;textgrid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data_classes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;utilities&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

        </details>

            </section>
                <section id="audio">
                                <div class="attr module"><a class="headerlink" href="#audio">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/audio.html">praatio.audio</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions for reading, writing, querying, and manipulating audio.</span>

<span class="sd">see **examples/anonymize_recording.py**, **examples/delete_vowels.py**,</span>
<span class="sd">and **examples/extract_subwavs.py**</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">wave</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Final</span>

<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">utils</span>

<span class="n">sampWidthDict</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;q&quot;</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">AudioDeletion</span><span class="p">:</span>
    <span class="n">SHRINK</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;shrink&quot;</span>
    <span class="n">SILENCE</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;silence&quot;</span>
    <span class="n">SINE_WAVE</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;sine wave&quot;</span>


<span class="n">_KEEP</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;keep&quot;</span>
<span class="n">_DELETE</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span>

<span class="n">ZERO_CROSSING_TIMESTEP</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mf">0.002</span>


<span class="k">def</span> <span class="nf">samplesAsNums</span><span class="p">(</span><span class="n">waveData</span><span class="p">,</span> <span class="n">sampleWidth</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Convert samples of a python wave object from bytes to numbers&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveData</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">EndOfAudioData</span><span class="p">()</span>

    <span class="n">byteCode</span> <span class="o">=</span> <span class="n">sampWidthDict</span><span class="p">[</span><span class="n">sampleWidth</span><span class="p">]</span>
    <span class="n">actualNumFrames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waveData</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">sampleWidth</span><span class="p">))</span>
    <span class="n">audioFrameList</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">byteCode</span> <span class="o">*</span> <span class="n">actualNumFrames</span><span class="p">,</span> <span class="n">waveData</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">audioFrameList</span>


<span class="k">def</span> <span class="nf">numsAsSamples</span><span class="p">(</span><span class="n">sampleWidth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">numList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convert audio data from numbers to bytes&quot;&quot;&quot;</span>
    <span class="n">byteCode</span> <span class="o">=</span> <span class="n">sampWidthDict</span><span class="p">[</span><span class="n">sampleWidth</span><span class="p">]</span>
    <span class="n">byteStr</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">byteCode</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">numList</span><span class="p">),</span> <span class="o">*</span><span class="n">numList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">byteStr</span>


<span class="k">def</span> <span class="nf">getDuration</span><span class="p">(</span><span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">WavQueryObj</span><span class="p">(</span><span class="n">wavFN</span><span class="p">)</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">getMaxAmplitude</span><span class="p">(</span><span class="n">sampleWidth</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Gets the maximum possible amplitude for a given sample width&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">sampleWidth</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">generateSineWave</span><span class="p">(</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">samplingFreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">samplingFreq</span><span class="p">)</span>
    <span class="n">wavSpec</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samplingFreq</span><span class="p">)</span>
    <span class="n">sinWave</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">amplitude</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wavSpec</span> <span class="o">*</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSamples</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">sinWave</span>


<span class="k">def</span> <span class="nf">generateSilence</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">samplingFreq</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="n">silence</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">samplingFreq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">silence</span>


<span class="k">def</span> <span class="nf">extractSubwav</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">startT</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">endT</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">audioObj</span> <span class="o">=</span> <span class="n">openAudioFile</span><span class="p">(</span>
        <span class="n">fn</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">startT</span><span class="p">,</span> <span class="n">endT</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">doShrink</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">audioObj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AbstractWav</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nchannels</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comptype</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compname</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">findNearestZeroCrossing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">targetTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">timeStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">ZERO_CROSSING_TIMESTEP</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the nearest zero crossing at the given time in an audio file</span>

<span class="sd">        Looks both before and after the timeStamp</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">leftStartTime</span> <span class="o">=</span> <span class="n">rightStartTime</span> <span class="o">=</span> <span class="n">targetTime</span>
        <span class="n">fileDuration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>

        <span class="c1"># Find zero crossings</span>
        <span class="n">smallestLeft</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">smallestRight</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timeStamp</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">leftStartTime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">timeStamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findNextZeroCrossing</span><span class="p">(</span>
                        <span class="n">leftStartTime</span><span class="p">,</span> <span class="n">timeStep</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">FindZeroCrossingError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">smallestLeft</span> <span class="o">=</span> <span class="n">timeStamp</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">rightStartTime</span> <span class="o">&lt;</span> <span class="n">fileDuration</span><span class="p">:</span>
                    <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findNextZeroCrossing</span><span class="p">(</span>
                        <span class="n">rightStartTime</span><span class="p">,</span> <span class="n">timeStep</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">FindZeroCrossingError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">smallestRight</span> <span class="o">=</span> <span class="n">timestamp</span>

            <span class="k">if</span> <span class="n">smallestLeft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">smallestRight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">leftStartTime</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rightStartTime</span> <span class="o">&gt;</span> <span class="n">fileDuration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">FindZeroCrossingError</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fileDuration</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">leftStartTime</span> <span class="o">-=</span> <span class="n">timeStep</span>
                <span class="n">rightStartTime</span> <span class="o">+=</span> <span class="n">timeStep</span>

        <span class="k">if</span> <span class="n">smallestLeft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">leftDiff</span> <span class="o">=</span> <span class="n">targetTime</span> <span class="o">-</span> <span class="n">smallestLeft</span>

        <span class="k">if</span> <span class="n">smallestRight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rightDiff</span> <span class="o">=</span> <span class="n">smallestRight</span> <span class="o">-</span> <span class="n">targetTime</span>

        <span class="c1"># Is left or right smaller?</span>
        <span class="k">if</span> <span class="n">smallestLeft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zeroCrossingTime</span> <span class="o">=</span> <span class="n">smallestRight</span>
        <span class="k">elif</span> <span class="n">smallestRight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zeroCrossingTime</span> <span class="o">=</span> <span class="n">smallestLeft</span>
        <span class="k">elif</span> <span class="n">leftDiff</span> <span class="o">&lt;=</span> <span class="n">rightDiff</span><span class="p">:</span>
            <span class="n">zeroCrossingTime</span> <span class="o">=</span> <span class="n">smallestLeft</span>
        <span class="k">elif</span> <span class="n">leftDiff</span> <span class="o">&gt;</span> <span class="n">rightDiff</span><span class="p">:</span>
            <span class="n">zeroCrossingTime</span> <span class="o">=</span> <span class="n">smallestRight</span>

        <span class="k">if</span> <span class="n">zeroCrossingTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">FindZeroCrossingError</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fileDuration</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">zeroCrossingTime</span>

    <span class="k">def</span> <span class="nf">findNextZeroCrossing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">targetTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">timeStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">ZERO_CROSSING_TIMESTEP</span><span class="p">,</span>
        <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the nearest zero crossing, searching in one direction</span>

<span class="sd">        Can do a &#39;reverse&#39; search by setting reverse to True.  In that case,</span>
<span class="sd">        the sample list is searched from back to front.</span>

<span class="sd">        targetTime is the startTime if reverse=False and</span>
<span class="sd">            the endTime if reverse=True</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">targetTime</span>
        <span class="k">if</span> <span class="n">reverse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">startTime</span> <span class="o">=</span> <span class="n">targetTime</span> <span class="o">-</span> <span class="n">timeStep</span>

        <span class="c1"># Don&#39;t read over the edges</span>
        <span class="k">if</span> <span class="n">startTime</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timeStep</span> <span class="o">=</span> <span class="n">startTime</span> <span class="o">+</span> <span class="n">timeStep</span>
            <span class="n">startTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">startTime</span> <span class="o">+</span> <span class="n">timeStep</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDuration</span><span class="p">():</span>
            <span class="n">timeStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span>

        <span class="n">endTime</span> <span class="o">=</span> <span class="n">startTime</span> <span class="o">+</span> <span class="n">timeStep</span>

        <span class="c1"># 1 Get the acoustic information and the sign for each sample</span>
        <span class="n">frameList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamples</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">)</span>
        <span class="n">signList</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">frameList</span><span class="p">]</span>

        <span class="c1"># 2 did signs change?</span>
        <span class="n">changeList</span> <span class="o">=</span> <span class="p">[</span><span class="n">signList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">signList</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frameList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="c1"># 3 get samples where signs changed</span>
        <span class="c1"># (iterate backwards if reverse is true)</span>
        <span class="k">if</span> <span class="n">reverse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">changeList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">step</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">changeList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">changeIndexList</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span> <span class="k">if</span> <span class="n">changeList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># 4 return the zeroed frame closest to starting point</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zeroedFrame</span> <span class="o">=</span> <span class="n">changeIndexList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">FindZeroCrossingError</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">))</span>

        <span class="c1"># We found the zero by comparing points to the point adjacent to them.</span>
        <span class="c1"># It is possible the adjacent point is closer to zero than this one,</span>
        <span class="c1"># in which case, it is the better zeroedI</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">frameList</span><span class="p">[</span><span class="n">zeroedFrame</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">frameList</span><span class="p">[</span><span class="n">zeroedFrame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="n">zeroedFrame</span> <span class="o">=</span> <span class="n">zeroedFrame</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">adjustTime</span> <span class="o">=</span> <span class="n">zeroedFrame</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">startTime</span> <span class="o">+</span> <span class="n">adjustTime</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">getDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">getSamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">endTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">WavQueryObj</span><span class="p">(</span><span class="n">AbstractWav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for getting information about a wave file</span>

<span class="sd">    The wave file is never loaded--we only keep a reference to the</span>
<span class="sd">    fd.  All operations on WavQueryObj are fast.  WavQueryObjs don&#39;t</span>
<span class="sd">    (shouldn&#39;t) change state.  For doing multiple modifications,</span>
<span class="sd">    use a WavObj.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audiofile</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WavQueryObj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audiofile</span><span class="o">.</span><span class="n">getparams</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">targetFrames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prepend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sourceFrames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrames</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">prepend</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">newFrames</span> <span class="o">=</span> <span class="n">targetFrames</span> <span class="o">+</span> <span class="n">sourceFrames</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newFrames</span> <span class="o">=</span> <span class="n">sourceFrames</span> <span class="o">+</span> <span class="n">targetFrames</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outputModifiedWav</span><span class="p">(</span><span class="n">newFrames</span><span class="p">,</span> <span class="n">outputFN</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span>
        <span class="k">return</span> <span class="n">duration</span>

    <span class="k">def</span> <span class="nf">getFrames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endTime</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get frames with respect to time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">startTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">startTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">startFrame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">startTime</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">endTime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span>
            <span class="n">nFrames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nFrames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">-</span> <span class="n">startFrame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">audiofile</span><span class="o">.</span><span class="n">setpos</span><span class="p">(</span><span class="n">startFrame</span><span class="p">)</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audiofile</span><span class="o">.</span><span class="n">readframes</span><span class="p">(</span><span class="n">nFrames</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">frames</span>

    <span class="k">def</span> <span class="nf">getSamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">endTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFrames</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">)</span>
        <span class="n">audioFrameList</span> <span class="o">=</span> <span class="n">samplesAsNums</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">audioFrameList</span>

    <span class="k">def</span> <span class="nf">deleteWavSections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">keepList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">deleteList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;shrink&quot;</span><span class="p">,</span> <span class="s2">&quot;silence&quot;</span><span class="p">,</span> <span class="s2">&quot;sine wave&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AudioDeletion</span><span class="o">.</span><span class="n">SHRINK</span><span class="p">,</span>
        <span class="n">sineWaveAmplitude</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove from the audio all of the intervals</span>

<span class="sd">        DeleteList can easily be constructed from a textgrid tier</span>
<span class="sd">        e.g. deleteList = tg.tierDict[&quot;targetTier&quot;].entryList</span>

<span class="sd">        operation: &quot;shrink&quot; to shrink the file length or &quot;silence&quot; or</span>
<span class="sd">                   &quot;sine wave&quot; to replace the segment with silence or</span>
<span class="sd">                   a sine wave</span>
<span class="sd">        sineWaveAmplitude: if None and operation is &quot;sine wave&quot;</span>
<span class="sd">                           use max amplitude.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operationOptions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">AudioDeletion</span><span class="o">.</span><span class="n">SHRINK</span><span class="p">,</span>
            <span class="n">AudioDeletion</span><span class="o">.</span><span class="n">SILENCE</span><span class="p">,</span>
            <span class="n">AudioDeletion</span><span class="o">.</span><span class="n">SINE_WAVE</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">operationOptions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">WrongOption</span><span class="p">(</span><span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">operationOptions</span><span class="p">)</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">keepList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">keepList</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
                <span class="s2">&quot;You must specify &#39;keepList&#39; or &#39;deleteList&#39; but not both.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">keepList</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">computedKeepList</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invertIntervalList</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">deleteList</span><span class="p">],</span> <span class="n">duration</span>
            <span class="p">)</span>
            <span class="n">computedDeleteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">keepList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">computedKeepList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">computedDeleteList</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invertIntervalList</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">keepList</span><span class="p">],</span> <span class="n">duration</span>
            <span class="p">)</span>
        <span class="n">keepList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_KEEP</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">computedKeepList</span><span class="p">]</span>
        <span class="n">deleteList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_DELETE</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">computedDeleteList</span><span class="p">]</span>
        <span class="n">iterList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keepList</span> <span class="o">+</span> <span class="n">deleteList</span><span class="p">)</span>

        <span class="n">zeroBinValue</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">sampWidthDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Grab the sections to be kept</span>
        <span class="n">audioFrames</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">iterList</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="n">_KEEP</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">audiofile</span><span class="o">.</span><span class="n">setpos</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">start</span><span class="p">))</span>
                <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audiofile</span><span class="o">.</span><span class="n">readframes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">diff</span><span class="p">))</span>
                <span class="n">audioFrames</span> <span class="o">+=</span> <span class="n">frames</span>

            <span class="c1"># If we are not keeping a region and we&#39;re not shrinking the</span>
            <span class="c1"># duration, fill in the deleted portions with zeros</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="n">_DELETE</span> <span class="ow">and</span> <span class="n">operation</span> <span class="o">==</span> <span class="n">AudioDeletion</span><span class="o">.</span><span class="n">SILENCE</span><span class="p">:</span>
                <span class="n">frames</span> <span class="o">=</span> <span class="n">zeroBinValue</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span>
                <span class="n">audioFrames</span> <span class="o">+=</span> <span class="n">frames</span>
            <span class="c1"># Or fill it with a sine wave</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="n">_DELETE</span> <span class="ow">and</span> <span class="n">operation</span> <span class="o">==</span> <span class="n">AudioDeletion</span><span class="o">.</span><span class="n">SINE_WAVE</span><span class="p">:</span>
                <span class="n">frequency</span> <span class="o">=</span> <span class="mi">200</span>
                <span class="k">if</span> <span class="n">sineWaveAmplitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sineWaveAmplitude</span> <span class="o">=</span> <span class="n">getMaxAmplitude</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">)</span>
                <span class="n">sineWave</span> <span class="o">=</span> <span class="n">generateSineWave</span><span class="p">(</span>
                    <span class="n">diff</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">,</span> <span class="n">sineWaveAmplitude</span>
                <span class="p">)</span>
                <span class="n">frames</span> <span class="o">=</span> <span class="n">numsAsSamples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">,</span> <span class="n">sineWave</span><span class="p">)</span>
                <span class="n">audioFrames</span> <span class="o">+=</span> <span class="n">frames</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">outputModifiedWav</span><span class="p">(</span><span class="n">audioFrames</span><span class="p">,</span> <span class="n">outputFN</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">outputModifiedWav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audioFrames</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output frames using the same parameters as this WavQueryObj</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Output resulting wav file</span>
        <span class="n">outParams</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nchannels</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">audioFrames</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comptype</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compname</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">outWave</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">outWave</span><span class="o">.</span><span class="n">setparams</span><span class="p">(</span><span class="n">outParams</span><span class="p">)</span>
        <span class="n">outWave</span><span class="o">.</span><span class="n">writeframes</span><span class="p">(</span><span class="n">audioFrames</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">WavObj</span><span class="p">(</span><span class="n">AbstractWav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for manipulating audio files</span>

<span class="sd">    The wav file is represented by its wavform as a series of signed</span>
<span class="sd">    integers.  This can be very slow and take up lots of memory with</span>
<span class="sd">    large files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audioSamples</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span> <span class="o">=</span> <span class="n">audioSamples</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WavObj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getIndexAtTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">startTime</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insertSilence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">silenceDuration</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">audioSamples</span> <span class="o">=</span> <span class="n">generateSilence</span><span class="p">(</span><span class="n">silenceDuration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span> <span class="n">audioSamples</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">audioSamples</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndexAtTime</span><span class="p">(</span><span class="n">startTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">audioSamples</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">deleteSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">endTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndexAtTime</span><span class="p">(</span><span class="n">startTime</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndexAtTime</span><span class="p">(</span><span class="n">endTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">[</span><span class="n">j</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">getDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span>

    <span class="k">def</span> <span class="nf">getSamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">endTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndexAtTime</span><span class="p">(</span><span class="n">startTime</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndexAtTime</span><span class="p">(</span><span class="n">endTime</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">getSubsegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">endTime</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WavObj&quot;</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamples</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">WavObj</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Output resulting wav file</span>
        <span class="n">outParams</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nchannels</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comptype</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compname</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">byteCode</span> <span class="o">=</span> <span class="n">sampWidthDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampwidth</span><span class="p">]</span>
        <span class="n">byteStr</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
            <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">byteCode</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">audioSamples</span>
        <span class="p">)</span>

        <span class="n">outWave</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">outWave</span><span class="o">.</span><span class="n">setparams</span><span class="p">(</span><span class="n">outParams</span><span class="p">)</span>
        <span class="n">outWave</span><span class="o">.</span><span class="n">writeframes</span><span class="p">(</span><span class="n">byteStr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">openAudioFile</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">keepList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">deleteList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">doShrink</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WavObj</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove from the audio all of the intervals</span>

<span class="sd">    keepList - specifies the segments to keep; by default, everything is kept</span>
<span class="sd">    doShrink - if False, segments not kept are replaced by silence</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">audiofile</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">audiofile</span><span class="o">.</span><span class="n">getparams</span><span class="p">()</span>
    <span class="n">sampwidth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">framerate</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">nframes</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">nframes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">framerate</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">keepList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
            <span class="s2">&quot;You cannot specify both &#39;keepList&#39; or &#39;deleteList&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">keepList</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">computedKeepList</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invertIntervalList</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">deleteList</span><span class="p">],</span> <span class="n">duration</span>
        <span class="p">)</span>
        <span class="n">computedDeleteList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">deleteList</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">keepList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">computedKeepList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">computedDeleteList</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">invertIntervalList</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">keepList</span><span class="p">],</span> <span class="n">duration</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">computedKeepList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">computedDeleteList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">keepList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_KEEP</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">computedKeepList</span><span class="p">]</span>
    <span class="n">deleteList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_DELETE</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">computedDeleteList</span><span class="p">]</span>
    <span class="n">iterList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keepList</span> <span class="o">+</span> <span class="n">deleteList</span><span class="p">)</span>

    <span class="c1"># Grab the sections to be kept</span>
    <span class="n">audioSampleList</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">byteCode</span> <span class="o">=</span> <span class="n">sampWidthDict</span><span class="p">[</span><span class="n">sampwidth</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">iterList</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="n">_KEEP</span><span class="p">:</span>
            <span class="n">audiofile</span><span class="o">.</span><span class="n">setpos</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">start</span><span class="p">))</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">audiofile</span><span class="o">.</span><span class="n">readframes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">diff</span><span class="p">))</span>

            <span class="n">actualNumFrames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">sampwidth</span><span class="p">))</span>
            <span class="n">audioSamples</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">byteCode</span> <span class="o">*</span> <span class="n">actualNumFrames</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span>
            <span class="n">audioSampleList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">audioSamples</span><span class="p">)</span>

        <span class="c1"># If we are not keeping a region and we&#39;re not shrinking the</span>
        <span class="c1"># duration, fill in the deleted portions with zeros</span>
        <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="n">_DELETE</span> <span class="ow">and</span> <span class="n">doShrink</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">zeroPadding</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">framerate</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">audioSampleList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">zeroPadding</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">WavObj</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">audioSampleList</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Functions for reading, writing, querying, and manipulating audio.</p>

<p>see <strong>examples/anonymize_recording.py</strong>, <strong>examples/delete_vowels.py</strong>,
and <strong>examples/extract_subwavs.py</strong></p>
</div>


                </section>
                <section id="data_points">
                                <div class="attr module"><a class="headerlink" href="#data_points">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/data_points.html">praatio.data_points</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Code for reading, writing, and representing less complicated praat data files</span>

<span class="sd">see **examples/get_vowel_points.py**</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">praatio.data_classes.data_point</span> <span class="kn">import</span> <span class="n">PointObject1D</span><span class="p">,</span> <span class="n">PointObject2D</span>


<span class="k">def</span> <span class="nf">open1DPointObject</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PointObject1D</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;xmin&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[:</span><span class="mi">100</span><span class="p">]:</span>  <span class="c1"># Kindof lazy</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span> <span class="o">=</span> <span class="n">_parseNormalHeader</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">pointVal</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">_getNextValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">pointVal</span><span class="p">),))</span>

        <span class="n">po</span> <span class="o">=</span> <span class="n">PointObject1D</span><span class="p">(</span><span class="n">dataList</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span> <span class="o">=</span> <span class="n">_parseShortHeader</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">),)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">po</span> <span class="o">=</span> <span class="n">PointObject1D</span><span class="p">(</span><span class="n">dataList</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">po</span>


<span class="k">def</span> <span class="nf">open2DPointObject</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PointObject2D</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;xmin&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[:</span><span class="mi">100</span><span class="p">]:</span>  <span class="c1"># Kindof lazy</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span> <span class="o">=</span> <span class="n">_parseNormalHeader</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">timeVal</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">_getNextValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">pointVal</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">_getNextValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">timeVal</span><span class="p">),</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">pointVal</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">po</span> <span class="o">=</span> <span class="n">PointObject2D</span><span class="p">(</span><span class="n">dataList</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span> <span class="o">=</span> <span class="n">_parseShortHeader</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">dataStrList</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dataStrList</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dataStrList</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataStrList</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataStrList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">]</span>
        <span class="n">po</span> <span class="o">=</span> <span class="n">PointObject2D</span><span class="p">(</span><span class="n">dataList</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">po</span>


<span class="k">def</span> <span class="nf">_parseNormalHeader</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">chunkedData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="n">objectType</span> <span class="o">=</span> <span class="n">chunkedData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">objectType</span> <span class="o">=</span> <span class="n">objectType</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">chunkedData</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">maxT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chunkedData</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">minT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chunkedData</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span>


<span class="k">def</span> <span class="nf">_getNextValue</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">,</span> <span class="n">end</span>


<span class="k">def</span> <span class="nf">_parseShortHeader</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">chunkedData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">objectType</span> <span class="o">=</span> <span class="n">chunkedData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">objectType</span> <span class="o">=</span> <span class="n">objectType</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">chunkedData</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">maxT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chunkedData</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">minT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chunkedData</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">objectType</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span>
</pre></div>

        </details>

            <div class="docstring"><p>Code for reading, writing, and representing less complicated praat data files</p>

<p>see <strong>examples/get_vowel_points.py</strong></p>
</div>


                </section>
                <section id="klattgrid">
                                <div class="attr module"><a class="headerlink" href="#klattgrid">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/klattgrid.html">praatio.klattgrid</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions for reading/writing/manipulating klattgrid files</span>

<span class="sd">A klattgrid can be used for speech synthesis/resynthesis.</span>
<span class="sd">For more information on the praat klattgrid:</span>
<span class="sd">http://www.fon.hum.uva.nl/praat/manual/KlattGrid.html</span>

<span class="sd">There are three kinds of data types in a klattgrid:</span>
<span class="sd">null tiers (contain no data points -- seem to function as headers for a</span>
<span class="sd">            set of regular tiers)</span>
<span class="sd">regular tiers</span>
<span class="sd">embedded tiers</span>

<span class="sd">In this code:</span>
<span class="sd">null tiers and regular tiers are both represented by KlattPointTier</span>

<span class="sd">embedded tiers contain tiers of tiers (3 layers)</span>
<span class="sd">A KlattContainerTier contains a list of KlattIntermediateTiers which</span>
<span class="sd">contains a list of KlattSubPointTiers.  Only the KlattSubPointTiers contain</span>
<span class="sd">any points</span>

<span class="sd">see **examples/klatt_resynthesis.py**</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">praatio.data_classes.klattgrid</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Klattgrid</span><span class="p">,</span>
    <span class="n">KlattPointTier</span><span class="p">,</span>
    <span class="n">KlattContainerTier</span><span class="p">,</span>
    <span class="n">KlattSubPointTier</span><span class="p">,</span>
    <span class="n">KlattIntermediateTier</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">utils</span>


<span class="k">def</span> <span class="nf">openKlattgrid</span><span class="p">(</span><span class="n">fnFullPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Klattgrid</span><span class="p">:</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fnFullPath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-16&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fnFullPath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Right now, can only open normal klatt grid and not short ones</span>
    <span class="n">kg</span> <span class="o">=</span> <span class="n">_openNormalKlattgrid</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kg</span>


<span class="k">def</span> <span class="nf">wavToKlattgrid</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputFullPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFullPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">timeStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span>
    <span class="n">numFormants</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">maxFormantFreq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5500.0</span><span class="p">,</span>
    <span class="n">windowLength</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span>
    <span class="n">preEmphasis</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span>
    <span class="n">pitchFloor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">60.0</span><span class="p">,</span>
    <span class="n">pitchCeiling</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">600.0</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span>
    <span class="n">subtractMean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the klattgrid from a wav file</span>

<span class="sd">    The default values are the same as the ones used in praat</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subtractMean</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">subtractMeanStr</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subtractMeanStr</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>

    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;sound_to_klattgrid.praat&quot;</span><span class="p">)</span>

    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span>
        <span class="n">praatEXE</span><span class="p">,</span>
        <span class="n">scriptFN</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">inputFullPath</span><span class="p">,</span>
            <span class="n">outputFullPath</span><span class="p">,</span>
            <span class="n">timeStep</span><span class="p">,</span>
            <span class="n">numFormants</span><span class="p">,</span>
            <span class="n">maxFormantFreq</span><span class="p">,</span>
            <span class="n">windowLength</span><span class="p">,</span>
            <span class="n">preEmphasis</span><span class="p">,</span>
            <span class="n">pitchFloor</span><span class="p">,</span>
            <span class="n">pitchCeiling</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">subtractMeanStr</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">resynthesize</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">klattFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">doCascade</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">doCascade</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;Cascade&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;Parallel&quot;</span>

    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;resynthesize_from_klattgrid.praat&quot;</span><span class="p">)</span>

    <span class="c1">#  Praat crashes on exit after resynthesis with a klattgrid</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="p">[</span><span class="n">wavFN</span><span class="p">,</span> <span class="n">klattFN</span><span class="p">,</span> <span class="n">outputWavFN</span><span class="p">,</span> <span class="n">method</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_openNormalKlattgrid</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Klattgrid</span><span class="p">:</span>

    <span class="n">kg</span> <span class="o">=</span> <span class="n">Klattgrid</span><span class="p">()</span>

    <span class="c1"># Toss header</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Not sure if this is needed</span>
    <span class="n">startI</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;points&quot;</span><span class="p">)</span>
    <span class="n">startI</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">startI</span><span class="p">)</span>

    <span class="c1"># Find sections</span>
    <span class="n">sectionIndexList</span> <span class="o">=</span> <span class="n">_findIndicies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;&lt;exists&gt;&quot;</span><span class="p">)</span>

    <span class="n">sectionIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sectionIndexList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">dataTuple</span> <span class="o">=</span> <span class="n">_getSectionHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sectionIndexList</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">,</span> <span class="n">sectionData</span><span class="p">,</span> <span class="n">sectionTuple</span> <span class="o">=</span> <span class="n">dataTuple</span>

        <span class="c1"># Container Tier</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;oral_formants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nasal_formants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nasal_antiformants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tracheal_formants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tracheal_antiformants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;delta_formants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;frication_formants&quot;</span><span class="p">,</span>
        <span class="p">]:</span>

            <span class="n">kct</span> <span class="o">=</span> <span class="n">_proccessContainerTierInput</span><span class="p">(</span><span class="n">sectionData</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">kg</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">kct</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Process entries if this tier has any</span>
            <span class="n">entryList</span> <span class="o">=</span> <span class="n">_buildEntryList</span><span class="p">(</span><span class="n">sectionTuple</span><span class="p">)</span>
            <span class="n">tier</span> <span class="o">=</span> <span class="n">KlattPointTier</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">entryList</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">)</span>
            <span class="n">kg</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">tier</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kg</span>


<span class="k">def</span> <span class="nf">_proccessContainerTierInput</span><span class="p">(</span><span class="n">sectionData</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">sectionData</span> <span class="o">=</span> <span class="n">sectionData</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">formantIndexList</span> <span class="o">=</span> <span class="n">_findIndicies</span><span class="p">(</span><span class="n">sectionData</span><span class="p">,</span> <span class="s2">&quot;formants&quot;</span><span class="p">)</span>

    <span class="n">subFilterList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;bandwidths&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oral_formants_amplitudes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nasal_formants_amplitudes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tracheal_formants_amplitudes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frication_formants_amplitudes&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Find the index of all the different data sections</span>
    <span class="n">subFilterIndexList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_findIndicies</span><span class="p">(</span><span class="n">sectionData</span><span class="p">,</span> <span class="n">subName</span><span class="p">)</span> <span class="k">for</span> <span class="n">subName</span> <span class="ow">in</span> <span class="n">subFilterList</span>
    <span class="p">]</span>

    <span class="c1"># &#39;Formant&#39; search query finds duplicates -- remove them</span>
    <span class="n">newFormantList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">formantIndexList</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subList</span> <span class="k">for</span> <span class="n">subList</span> <span class="ow">in</span> <span class="n">subFilterIndexList</span><span class="p">]):</span>
            <span class="n">newFormantList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">formantIndexList</span> <span class="o">=</span> <span class="n">newFormantList</span>

    <span class="c1"># Combine regular query with formant query</span>
    <span class="n">indexListOfLists</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">formantIndexList</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">+</span> <span class="n">subFilterIndexList</span>

    <span class="c1"># Flatten index list</span>
    <span class="n">masterIndexList</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">indexListOfLists</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">masterIndexList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># If an index list is last, it it needs to include &#39;-1&#39; to capture the</span>
    <span class="c1"># rest of the data</span>
    <span class="k">for</span> <span class="n">subList</span> <span class="ow">in</span> <span class="n">indexListOfLists</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">subList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">masterIndexList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># Index of the index</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masterIndexList</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">subList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Build the tier structure</span>
    <span class="n">kct</span> <span class="o">=</span> <span class="n">KlattContainerTier</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">indexList</span> <span class="ow">in</span> <span class="n">indexListOfLists</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">indexList</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">continue</span>
        <span class="n">tierList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indexList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmpTuple</span> <span class="o">=</span> <span class="n">_getSectionHeader</span><span class="p">(</span><span class="n">sectionData</span><span class="p">,</span> <span class="n">indexList</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">subName</span><span class="p">,</span> <span class="n">subMin</span><span class="p">,</span> <span class="n">subMax</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">subTuple</span> <span class="o">=</span> <span class="n">tmpTuple</span>
            <span class="n">subName</span> <span class="o">=</span> <span class="n">subName</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">entryList</span> <span class="o">=</span> <span class="n">_buildEntryList</span><span class="p">(</span><span class="n">subTuple</span><span class="p">)</span>
            <span class="n">tier</span> <span class="o">=</span> <span class="n">KlattSubPointTier</span><span class="p">(</span><span class="n">subName</span><span class="p">,</span> <span class="n">entryList</span><span class="p">,</span> <span class="n">subMin</span><span class="p">,</span> <span class="n">subMax</span><span class="p">)</span>
            <span class="n">tierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tier</span><span class="p">)</span>
        <span class="n">kit</span> <span class="o">=</span> <span class="n">KlattIntermediateTier</span><span class="p">(</span><span class="n">subName</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">tier</span> <span class="ow">in</span> <span class="n">tierList</span><span class="p">:</span>
            <span class="n">kit</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">tier</span><span class="p">)</span>
        <span class="n">kct</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">kit</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kct</span>


<span class="k">def</span> <span class="nf">_findIndicies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
    <span class="n">indexList</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">keyword</span><span class="p">)</span>
    <span class="n">indexList</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexList</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">indexList</span>


<span class="k">def</span> <span class="nf">_getSectionHeader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indexList</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">sectionStart</span> <span class="o">=</span> <span class="n">indexList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sectionEnd</span> <span class="o">=</span> <span class="n">indexList</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">sectionData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">sectionStart</span><span class="p">:</span><span class="n">sectionEnd</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">sectionTuple</span> <span class="o">=</span> <span class="n">sectionData</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">subheader</span><span class="p">,</span> <span class="n">minr</span><span class="p">,</span> <span class="n">maxr</span> <span class="o">=</span> <span class="n">sectionTuple</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">subheader</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">minT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">minr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">maxT</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">tail</span> <span class="o">=</span> <span class="n">sectionTuple</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">,</span> <span class="n">sectionData</span><span class="p">,</span> <span class="n">tail</span>


<span class="k">def</span> <span class="nf">_buildEntryList</span><span class="p">(</span><span class="n">sectionTuple</span><span class="p">):</span>
    <span class="n">entryList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sectionTuple</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Has points</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sectionTuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">npoints</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">entryList</span> <span class="o">=</span> <span class="n">_processSectionData</span><span class="p">(</span><span class="n">sectionTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">entryList</span>


<span class="k">def</span> <span class="nf">_processSectionData</span><span class="p">(</span><span class="n">sectionData</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>

    <span class="n">sectionData</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">startI</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tupleList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">startI</span> <span class="o">=</span> <span class="n">sectionData</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">startI</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Past the equal sign</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># No more data</span>
            <span class="k">break</span>

        <span class="n">endI</span> <span class="o">=</span> <span class="n">sectionData</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">startI</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sectionData</span><span class="p">[</span><span class="n">startI</span><span class="p">:</span><span class="n">endI</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="n">startI</span> <span class="o">=</span> <span class="n">sectionData</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">endI</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Just past the &#39;=&#39; sign</span>
        <span class="n">endI</span> <span class="o">=</span> <span class="n">sectionData</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">startI</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sectionData</span><span class="p">[</span><span class="n">startI</span><span class="p">:</span><span class="n">endI</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="n">startI</span> <span class="o">=</span> <span class="n">endI</span>
        <span class="n">tupleList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">tupleList</span>
</pre></div>

        </details>

            <div class="docstring"><p>Functions for reading/writing/manipulating klattgrid files</p>

<p>A klattgrid can be used for speech synthesis/resynthesis.
For more information on the praat klattgrid:
http://www.fon.hum.uva.nl/praat/manual/KlattGrid.html</p>

<p>There are three kinds of data types in a klattgrid:
null tiers (contain no data points -- seem to function as headers for a
            set of regular tiers)
regular tiers
embedded tiers</p>

<p>In this code:
null tiers and regular tiers are both represented by KlattPointTier</p>

<p>embedded tiers contain tiers of tiers (3 layers)
A KlattContainerTier contains a list of KlattIntermediateTiers which
contains a list of KlattSubPointTiers.  Only the KlattSubPointTiers contain
any points</p>

<p>see <strong>examples/klatt_resynthesis.py</strong></p>
</div>


                </section>
                <section id="pitch_and_intensity">
                                <div class="attr module"><a class="headerlink" href="#pitch_and_intensity">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/pitch_and_intensity.html">praatio.pitch_and_intensity</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="c1"># coding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions for working with pitch data</span>

<span class="sd">This file depends on the praat script get_pitch_and_intensity.praat</span>
<span class="sd">(which depends on praat) to extract pitch and intensity values from</span>
<span class="sd">audio data.  Once the data is extracted, there are functions for</span>
<span class="sd">data normalization and calculating various measures from the time</span>
<span class="sd">stamped output of the praat script (ie **generatePIMeasures()**)</span>

<span class="sd">For brevity, &#39;pitch_and_intensity&#39; is referred to as &#39;PI&#39;</span>

<span class="sd">see **examples/get_pitch_and_formants.py**</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">data_points</span>
<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">praatio_scripts</span>
<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">textgrid</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">my_math</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">praatio.utilities.constants</span> <span class="kn">import</span> <span class="n">Point</span>


<span class="n">HERTZ</span> <span class="o">=</span> <span class="s2">&quot;Hertz&quot;</span>
<span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="s2">&quot;unspecified&quot;</span>
<span class="n">_PITCH_ERROR_TIER_NAME</span> <span class="o">=</span> <span class="s2">&quot;pitch errors&quot;</span>


<span class="k">def</span> <span class="nf">_extractPIPiecewise</span><span class="p">(</span>
    <span class="n">inputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tgFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tmpOutputPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sampleStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">silenceThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
    <span class="n">pitchUnit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">HERTZ</span><span class="p">,</span>
    <span class="n">forceRegenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">undefinedValue</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pitchQuadInterp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts pitch and int from each labeled interval in a textgrid</span>

<span class="sd">    This has the benefit of being faster than using _extractPIFile if only</span>
<span class="sd">    labeled regions need to have their pitch values sampled, particularly</span>
<span class="sd">    for longer files.</span>

<span class="sd">    Returns the result as a list.  Will load the serialized result</span>
<span class="sd">    if this has already been called on the appropriate files before</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

    <span class="n">windowSize</span> <span class="o">=</span> <span class="n">medianFilterWindowSize</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputFN</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required folder does not exist: f</span><span class="si">{</span><span class="n">inputFN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">firstTime</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">firstTime</span> <span class="ow">or</span> <span class="n">forceRegenerate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">tmpOutputPath</span><span class="p">)</span>
        <span class="n">splitAudioList</span> <span class="o">=</span> <span class="n">praatio_scripts</span><span class="o">.</span><span class="n">splitAudioOnTier</span><span class="p">(</span>
            <span class="n">inputFN</span><span class="p">,</span> <span class="n">tgFN</span><span class="p">,</span> <span class="n">tierName</span><span class="p">,</span> <span class="n">tmpOutputPath</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">allPIList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">splitAudioList</span><span class="p">:</span>
            <span class="n">tmpTrackName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
            <span class="n">piList</span> <span class="o">=</span> <span class="n">_extractPIFile</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span><span class="n">tmpOutputPath</span><span class="p">,</span> <span class="n">fn</span><span class="p">),</span>
                <span class="n">join</span><span class="p">(</span><span class="n">tmpOutputPath</span><span class="p">,</span> <span class="n">tmpTrackName</span><span class="p">),</span>
                <span class="n">praatEXE</span><span class="p">,</span>
                <span class="n">minPitch</span><span class="p">,</span>
                <span class="n">maxPitch</span><span class="p">,</span>
                <span class="n">sampleStep</span><span class="p">,</span>
                <span class="n">silenceThreshold</span><span class="p">,</span>
                <span class="n">pitchUnit</span><span class="p">,</span>
                <span class="n">forceRegenerate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">medianFilterWindowSize</span><span class="o">=</span><span class="n">windowSize</span><span class="p">,</span>
                <span class="n">pitchQuadInterp</span><span class="o">=</span><span class="n">pitchQuadInterp</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">convertedPiList</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;</span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="n">start</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pV</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">iV</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">pV</span><span class="p">,</span> <span class="n">iV</span> <span class="ow">in</span> <span class="n">piList</span>
            <span class="p">]</span>
            <span class="n">allPIList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">convertedPiList</span><span class="p">)</span>

        <span class="n">outputData</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">allPIList</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputData</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loadTimeSeriesData</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="n">undefinedValue</span><span class="o">=</span><span class="n">undefinedValue</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_extractPIFile</span><span class="p">(</span>
    <span class="n">inputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sampleStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">silenceThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
    <span class="n">pitchUnit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">HERTZ</span><span class="p">,</span>
    <span class="n">forceRegenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">undefinedValue</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pitchQuadInterp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts pitch and intensity values from an audio file</span>

<span class="sd">    Returns the result as a list.  Will load the serialized result</span>
<span class="sd">    if this has already been called on the appropriate files before</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputFN</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required folder does not exist: f</span><span class="si">{</span><span class="n">inputFN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">firstTime</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">firstTime</span> <span class="ow">or</span> <span class="n">forceRegenerate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

        <span class="c1"># The praat script uses append mode, so we need to clear any prior</span>
        <span class="c1"># result</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pitchQuadInterp</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">doInterpolation</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doInterpolation</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">inputFN</span><span class="p">,</span>
            <span class="n">outputFN</span><span class="p">,</span>
            <span class="n">sampleStep</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">maxPitch</span><span class="p">,</span>
            <span class="n">silenceThreshold</span><span class="p">,</span>
            <span class="n">pitchUnit</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">medianFilterWindowSize</span><span class="p">,</span>
            <span class="n">doInterpolation</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">scriptName</span> <span class="o">=</span> <span class="s2">&quot;get_pitch_and_intensity.praat&quot;</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="n">scriptName</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loadTimeSeriesData</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="n">undefinedValue</span><span class="o">=</span><span class="n">undefinedValue</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">extractIntensity</span><span class="p">(</span>
    <span class="n">inputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sampleStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">forceRegenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">undefinedValue</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the intensity for an audio file</span>

<span class="sd">    Calculates intensity using the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_Intensity___.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputFN</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required folder does not exist: f</span><span class="si">{</span><span class="n">inputFN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">firstTime</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">firstTime</span> <span class="ow">or</span> <span class="n">forceRegenerate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

        <span class="c1"># The praat script uses append mode, so we need to clear any prior</span>
        <span class="c1"># result</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>

        <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span><span class="n">inputFN</span><span class="p">,</span> <span class="n">outputFN</span><span class="p">,</span> <span class="n">sampleStep</span><span class="p">,</span> <span class="n">minPitch</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">scriptName</span> <span class="o">=</span> <span class="s2">&quot;get_intensity.praat&quot;</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="n">scriptName</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loadTimeSeriesData</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="n">undefinedValue</span><span class="o">=</span><span class="n">undefinedValue</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">extractPitchTier</span><span class="p">(</span>
    <span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sampleStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">silenceThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
    <span class="n">forceRegenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pitchQuadInterp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">data_points</span><span class="o">.</span><span class="n">PointObject2D</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract pitch at regular intervals from the input wav file</span>

<span class="sd">    Data is output to a text file and then returned in a list in the form</span>
<span class="sd">    [(timeV1, pitchV1), (timeV2, pitchV2), ...]</span>

<span class="sd">    sampleStep - the frequency to sample pitch at</span>
<span class="sd">    silenceThreshold - segments with lower intensity won&#39;t be analyzed</span>
<span class="sd">                       for pitch</span>
<span class="sd">    forceRegenerate - if running this function for the same file, if False</span>
<span class="sd">                      just read in the existing pitch file</span>
<span class="sd">    pitchQuadInterp - if True, quadratically interpolate pitch</span>

<span class="sd">    Calculates pitch using the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_Pitch___.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">utils</span><span class="o">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pitchQuadInterp</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">doInterpolation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">doInterpolation</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wavFN</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required file does not exist: f</span><span class="si">{</span><span class="n">wavFN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">firstTime</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">firstTime</span> <span class="ow">or</span> <span class="n">forceRegenerate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>

        <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">wavFN</span><span class="p">,</span>
            <span class="n">outputFN</span><span class="p">,</span>
            <span class="n">sampleStep</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">maxPitch</span><span class="p">,</span>
            <span class="n">silenceThreshold</span><span class="p">,</span>
            <span class="n">medianFilterWindowSize</span><span class="p">,</span>
            <span class="n">doInterpolation</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">scriptName</span> <span class="o">=</span> <span class="s2">&quot;get_pitchtier.praat&quot;</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="n">scriptName</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_points</span><span class="o">.</span><span class="n">open2DPointObject</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">extractPitch</span><span class="p">(</span>
    <span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sampleStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">silenceThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
    <span class="n">forceRegenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">undefinedValue</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pitchQuadInterp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract pitch at regular intervals from the input wav file</span>

<span class="sd">    Data is output to a text file and then returned in a list in the form</span>
<span class="sd">    [(timeV1, pitchV1), (timeV2, pitchV2), ...]</span>

<span class="sd">    sampleStep - the frequency to sample pitch at</span>
<span class="sd">    silenceThreshold - segments with lower intensity won&#39;t be analyzed</span>
<span class="sd">                       for pitch</span>
<span class="sd">    forceRegenerate - if running this function for the same file, if False</span>
<span class="sd">                      just read in the existing pitch file</span>
<span class="sd">    undefinedValue - if None remove from the dataset, otherset set to</span>
<span class="sd">                     undefinedValue</span>
<span class="sd">    pitchQuadInterp - if True, quadratically interpolate pitch</span>

<span class="sd">    Calculates pitch using the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_Pitch___.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">utils</span><span class="o">.</span><span class="n">makeDir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pitchQuadInterp</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">doInterpolation</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">doInterpolation</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wavFN</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required file does not exist: f</span><span class="si">{</span><span class="n">wavFN</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">firstTime</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">firstTime</span> <span class="ow">or</span> <span class="n">forceRegenerate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFN</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)</span>

        <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">wavFN</span><span class="p">,</span>
            <span class="n">outputFN</span><span class="p">,</span>
            <span class="n">sampleStep</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">maxPitch</span><span class="p">,</span>
            <span class="n">silenceThreshold</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">medianFilterWindowSize</span><span class="p">,</span>
            <span class="n">doInterpolation</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">scriptName</span> <span class="o">=</span> <span class="s2">&quot;get_pitch.praat&quot;</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="n">scriptName</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loadTimeSeriesData</span><span class="p">(</span><span class="n">outputFN</span><span class="p">,</span> <span class="n">undefinedValue</span><span class="o">=</span><span class="n">undefinedValue</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">extractPI</span><span class="p">(</span>
    <span class="n">inputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sampleStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">silenceThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
    <span class="n">pitchUnit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">HERTZ</span><span class="p">,</span>
    <span class="n">forceRegenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">tgFN</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tmpOutputPath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">undefinedValue</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pitchQuadInterp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts pitch and intensity from a file wholesale or piecewise</span>

<span class="sd">    If the parameters for a tg are passed in, this will only extract labeled</span>
<span class="sd">    segments in a tier of the tg.  Otherwise, pitch will be extracted from</span>
<span class="sd">    the entire file.</span>

<span class="sd">    male: minPitch=50; maxPitch=350</span>
<span class="sd">    female: minPitch=75; maxPitch=450</span>
<span class="sd">    pitchUnit: &quot;Hertz&quot;, &quot;semitones re 100 Hz&quot;, etc</span>

<span class="sd">    Calculates pitch and intensity using the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_Pitch___.html</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_Intensity___.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">windowSize</span> <span class="o">=</span> <span class="n">medianFilterWindowSize</span>

    <span class="k">if</span> <span class="n">tgFN</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tierName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">piList</span> <span class="o">=</span> <span class="n">_extractPIFile</span><span class="p">(</span>
            <span class="n">inputFN</span><span class="p">,</span>
            <span class="n">outputFN</span><span class="p">,</span>
            <span class="n">praatEXE</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">maxPitch</span><span class="p">,</span>
            <span class="n">sampleStep</span><span class="p">,</span>
            <span class="n">silenceThreshold</span><span class="p">,</span>
            <span class="n">pitchUnit</span><span class="p">,</span>
            <span class="n">forceRegenerate</span><span class="p">,</span>
            <span class="n">undefinedValue</span><span class="o">=</span><span class="n">undefinedValue</span><span class="p">,</span>
            <span class="n">medianFilterWindowSize</span><span class="o">=</span><span class="n">windowSize</span><span class="p">,</span>
            <span class="n">pitchQuadInterp</span><span class="o">=</span><span class="n">pitchQuadInterp</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tmpOutputPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmpOutputPath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="s2">&quot;piecewise_output&quot;</span><span class="p">)</span>
        <span class="n">piList</span> <span class="o">=</span> <span class="n">_extractPIPiecewise</span><span class="p">(</span>
            <span class="n">inputFN</span><span class="p">,</span>
            <span class="n">outputFN</span><span class="p">,</span>
            <span class="n">praatEXE</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">maxPitch</span><span class="p">,</span>
            <span class="n">tgFN</span><span class="p">,</span>
            <span class="n">tierName</span><span class="p">,</span>
            <span class="n">tmpOutputPath</span><span class="p">,</span>
            <span class="n">sampleStep</span><span class="p">,</span>
            <span class="n">silenceThreshold</span><span class="p">,</span>
            <span class="n">pitchUnit</span><span class="p">,</span>
            <span class="n">forceRegenerate</span><span class="p">,</span>
            <span class="n">undefinedValue</span><span class="o">=</span><span class="n">undefinedValue</span><span class="p">,</span>
            <span class="n">medianFilterWindowSize</span><span class="o">=</span><span class="n">windowSize</span><span class="p">,</span>
            <span class="n">pitchQuadInterp</span><span class="o">=</span><span class="n">pitchQuadInterp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">piList</span>


<span class="k">def</span> <span class="nf">loadTimeSeriesData</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">undefinedValue</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For reading the output of get_pitch_and_intensity or get_intensity</span>

<span class="sd">    Data should be of the form</span>
<span class="sd">    [(time1, value1a, value1b, ...),</span>
<span class="sd">     (time2, value2a, value2b, ...), ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fn</span><span class="p">)[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pitch track for: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">dataList</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">row</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="c1"># The new praat script includes a header</span>
    <span class="k">if</span> <span class="n">dataList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="n">dataList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">newDataList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataList</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">time</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">doSkip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;--&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">undefinedValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">appendValue</span> <span class="o">=</span> <span class="n">undefinedValue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">doSkip</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">appendValue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">appendValue</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">doSkip</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">newDataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">newDataList</span>


<span class="k">def</span> <span class="nf">generatePIMeasures</span><span class="p">(</span>
    <span class="n">dataList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">tgFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">doPitch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">globalZNormalization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">localZNormalizationWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates processed values for the labeled intervals in a textgrid</span>

<span class="sd">    nullLabelList - labels to ignore in the textgrid.  Defaults to [&quot;&quot;,]</span>

<span class="sd">    if &#39;doPitch&#39;=true get pitch measures; if =false get rms intensity</span>
<span class="sd">    medianFilterWindowSize: if none, no filtering is done</span>
<span class="sd">    globalZNormalization: if True, values are normalized with the mean</span>
<span class="sd">                          and stdDev of the data in dataList</span>
<span class="sd">    localZNormalization: if greater than 1, values are normalized with the mean</span>
<span class="sd">                         and stdDev of the local context (for a window of 5, it</span>
<span class="sd">                         would consider the current value, 2 values before and 2</span>
<span class="sd">                         values after)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Warn user that normalizing a second time nullifies the first normalization</span>
    <span class="k">if</span> <span class="n">globalZNormalization</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">localZNormalizationWindowSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">NormalizationException</span><span class="p">()</span>

    <span class="n">castDataList</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n">dataList</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">globalZNormalization</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">doPitch</span><span class="p">:</span>
            <span class="n">castDataList</span> <span class="o">=</span> <span class="n">my_math</span><span class="o">.</span><span class="n">znormalizeSpeakerData</span><span class="p">(</span><span class="n">castDataList</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">castDataList</span> <span class="o">=</span> <span class="n">my_math</span><span class="o">.</span><span class="n">znormalizeSpeakerData</span><span class="p">(</span><span class="n">castDataList</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Raw values should have 0 filtered; normalized values are centered around 0, so don&#39;t filter</span>
    <span class="n">filterZeroFlag</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">globalZNormalization</span>

    <span class="n">tg</span> <span class="o">=</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">openTextgrid</span><span class="p">(</span><span class="n">tgFN</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">],</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">IntervalTier</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">IncompatibleTierError</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">])</span>

    <span class="n">tier</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">textgrid</span><span class="o">.</span><span class="n">IntervalTier</span><span class="p">,</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">])</span>
    <span class="n">piData</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">getValuesInIntervals</span><span class="p">(</span><span class="n">castDataList</span><span class="p">)</span>

    <span class="n">outputList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">interval</span><span class="p">,</span> <span class="n">entryList</span> <span class="ow">in</span> <span class="n">piData</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">doPitch</span><span class="p">:</span>
            <span class="n">tmpValList</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0Val</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">f0Val</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">entryList</span><span class="p">]</span>
            <span class="n">f0Measures</span> <span class="o">=</span> <span class="n">getPitchMeasures</span><span class="p">(</span>
                <span class="n">tmpValList</span><span class="p">,</span> <span class="n">tgFN</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">medianFilterWindowSize</span><span class="p">,</span> <span class="n">filterZeroFlag</span>
            <span class="p">)</span>
            <span class="n">outputList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f0Measures</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpValList</span> <span class="o">=</span> <span class="p">[</span><span class="n">intensityVal</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensityVal</span> <span class="ow">in</span> <span class="n">entryList</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">filterZeroFlag</span><span class="p">:</span>
                <span class="n">tmpValList</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">intensityVal</span> <span class="k">for</span> <span class="n">intensityVal</span> <span class="ow">in</span> <span class="n">tmpValList</span> <span class="k">if</span> <span class="n">intensityVal</span> <span class="o">!=</span> <span class="mf">0.0</span>
                <span class="p">]</span>

            <span class="n">rmsIntensity</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpValList</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rmsIntensity</span> <span class="o">=</span> <span class="n">my_math</span><span class="o">.</span><span class="n">rms</span><span class="p">(</span><span class="n">tmpValList</span><span class="p">)</span>
            <span class="n">outputList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">rmsIntensity</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

    <span class="c1"># Locally normalize the output</span>
    <span class="k">if</span> <span class="n">localZNormalizationWindowSize</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">colI</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputList</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">featValList</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">colI</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outputList</span><span class="p">]</span>

            <span class="n">featValList</span> <span class="o">=</span> <span class="n">my_math</span><span class="o">.</span><span class="n">znormWindowFilter</span><span class="p">(</span>
                <span class="n">featValList</span><span class="p">,</span> <span class="n">localZNormalizationWindowSize</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">featValList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputList</span><span class="p">):</span>  <span class="c1"># This should hopefully not happen</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UnexpectedError</span><span class="p">(</span>
                    <span class="s2">&quot;Lists must be of the same length but are not: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">featValList</span><span class="p">)</span><span class="si">}</span><span class="s2">), (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outputList</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">featValList</span><span class="p">):</span>
                <span class="n">outputList</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">colI</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">return</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">outputList</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">getPitchMeasures</span><span class="p">(</span>
    <span class="n">f0Values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">medianFilterWindowSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filterZeroFlag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get various measures (min, max, etc) for the passed in list of pitch values</span>

<span class="sd">    name is the name of the file.  Label is the label of the current interval.</span>
<span class="sd">    Both of these labels are only used debugging and can be ignored if desired.</span>
<span class="sd">    medianFilterWindowSize: None -&gt; no median filtering</span>
<span class="sd">    filterZeroFlag:True -&gt; zero values are removed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">UNSPECIFIED</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">UNSPECIFIED</span>

    <span class="k">if</span> <span class="n">medianFilterWindowSize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f0Values</span> <span class="o">=</span> <span class="n">my_math</span><span class="o">.</span><span class="n">medianFilter</span><span class="p">(</span>
            <span class="n">f0Values</span><span class="p">,</span> <span class="n">medianFilterWindowSize</span><span class="p">,</span> <span class="n">useEdgePadding</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">filterZeroFlag</span><span class="p">:</span>
        <span class="n">f0Values</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0Val</span> <span class="k">for</span> <span class="n">f0Val</span> <span class="ow">in</span> <span class="n">f0Values</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0Val</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f0Values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">myStr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No pitch data for file: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, label: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">myStr</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">))</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">meanF0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">maxF0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">minF0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rangeF0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f0Values</span><span class="p">))</span>
        <span class="n">meanF0</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f0Values</span><span class="p">)</span> <span class="o">/</span> <span class="n">counts</span>
        <span class="n">maxF0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f0Values</span><span class="p">)</span>
        <span class="n">minF0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">f0Values</span><span class="p">)</span>
        <span class="n">rangeF0</span> <span class="o">=</span> <span class="n">maxF0</span> <span class="o">-</span> <span class="n">minF0</span>

        <span class="n">variance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">val</span> <span class="o">-</span> <span class="n">meanF0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">f0Values</span><span class="p">])</span> <span class="o">/</span> <span class="n">counts</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">meanF0</span><span class="p">,</span> <span class="n">maxF0</span><span class="p">,</span> <span class="n">minF0</span><span class="p">,</span> <span class="n">rangeF0</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">detectPitchErrors</span><span class="p">(</span>
    <span class="n">pitchList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">maxJumpThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.70</span><span class="p">,</span>
    <span class="n">tgToMark</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect pitch halving and doubling errors.</span>

<span class="sd">    If a textgrid is passed in, it adds the markings to the textgrid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">maxJumpThreshold</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">maxJumpThreshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;maxJumpThreshold&#39; must be between 0 and 1.  Was given (</span><span class="si">{</span><span class="n">maxJumpThreshold</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="n">tierName</span> <span class="o">=</span> <span class="n">_PITCH_ERROR_TIER_NAME</span>
    <span class="k">if</span> <span class="n">tgToMark</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tierName</span> <span class="ow">in</span> <span class="n">tgToMark</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tier name &#39;</span><span class="si">{</span><span class="n">tierName</span><span class="si">}</span><span class="s2">&#39; is already in provided textgrid&quot;</span>
        <span class="p">)</span>

    <span class="n">errorList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitchList</span><span class="p">)):</span>
        <span class="n">lastPitch</span> <span class="o">=</span> <span class="n">pitchList</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">currentPitch</span> <span class="o">=</span> <span class="n">pitchList</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ceilingCutoff</span> <span class="o">=</span> <span class="n">currentPitch</span> <span class="o">/</span> <span class="n">maxJumpThreshold</span>
        <span class="n">floorCutoff</span> <span class="o">=</span> <span class="n">currentPitch</span> <span class="o">*</span> <span class="n">maxJumpThreshold</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lastPitch</span> <span class="o">&lt;=</span> <span class="n">floorCutoff</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lastPitch</span> <span class="o">&gt;=</span> <span class="n">ceilingCutoff</span><span class="p">):</span>
            <span class="n">currentTime</span> <span class="o">=</span> <span class="n">pitchList</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">errorList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">currentPitch</span> <span class="o">/</span> <span class="n">lastPitch</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">tgToMark</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pointTier</span> <span class="o">=</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">PointTier</span><span class="p">(</span>
            <span class="n">tierName</span><span class="p">,</span> <span class="n">errorList</span><span class="p">,</span> <span class="n">tgToMark</span><span class="o">.</span><span class="n">minTimestamp</span><span class="p">,</span> <span class="n">tgToMark</span><span class="o">.</span><span class="n">maxTimestamp</span>
        <span class="p">)</span>
        <span class="n">tgToMark</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">pointTier</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errorList</span><span class="p">,</span> <span class="n">tgToMark</span>
</pre></div>

        </details>

            <div class="docstring"><p>Functions for working with pitch data</p>

<p>This file depends on the praat script get_pitch_and_intensity.praat
(which depends on praat) to extract pitch and intensity values from
audio data.  Once the data is extracted, there are functions for
data normalization and calculating various measures from the time
stamped output of the praat script (ie <strong>generatePIMeasures()</strong>)</p>

<p>For brevity, 'pitch_and_intensity' is referred to as 'PI'</p>

<p>see <strong>examples/get_pitch_and_formants.py</strong></p>
</div>


                </section>
                <section id="praat_scripts">
                                <div class="attr module"><a class="headerlink" href="#praat_scripts">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/praat_scripts.html">praatio.praat_scripts</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Python wrappers for various praat scripts contained in /praatScripts.</span>

<span class="sd">see **examples/auto_segment_speech.py**, **examples/get_pitch_and_formants.py**,</span>
<span class="sd">**klatt_resynthesis.py**</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">audio</span>
<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">data_points</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">utils</span>

<span class="n">SILENCE_LABEL</span> <span class="o">=</span> <span class="s2">&quot;silent&quot;</span>
<span class="n">SOUND_LABEL</span> <span class="o">=</span> <span class="s2">&quot;sound&quot;</span>


<span class="k">def</span> <span class="nf">changeGender</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pitchFloor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pitchCeiling</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">formantShiftRatio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pitchMedian</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">pitchRange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the speech formants in a file using praat&#39;s change gender function</span>

<span class="sd">    PitchMedian = 0.0; no change in median pitch</span>
<span class="sd">    PitchRange = 1.0; no change in pitch range</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__Change_gender___.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;change_gender.praat&quot;</span><span class="p">)</span>

    <span class="c1">#  Praat crashes on exit after resynthesis with a klattgrid</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span>
        <span class="n">praatEXE</span><span class="p">,</span>
        <span class="n">scriptFN</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">wavFN</span><span class="p">,</span>
            <span class="n">outputWavFN</span><span class="p">,</span>
            <span class="n">pitchFloor</span><span class="p">,</span>
            <span class="n">pitchCeiling</span><span class="p">,</span>
            <span class="n">formantShiftRatio</span><span class="p">,</span>
            <span class="n">pitchMedian</span><span class="p">,</span>
            <span class="n">pitchRange</span><span class="p">,</span>
            <span class="n">duration</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">changeIntensity</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">newIntensity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the intensity of the wavFN (in db)</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__Scale_intensity___.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;change_intensity.praat&quot;</span><span class="p">)</span>

    <span class="c1">#  Praat crashes on exit after resynthesis with a klattgrid</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="p">[</span><span class="n">wavFN</span><span class="p">,</span> <span class="n">outputWavFN</span><span class="p">,</span> <span class="n">newIntensity</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">getFormants</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputTxtFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">maxFormant</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">stepSize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">window_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span>
    <span class="n">preemphasis</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">undefinedValue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get F1, F2, and F3 for the audio file</span>

<span class="sd">    maxFormant = 5500 for females, 5000 for males, &lt;8000 for children</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_Formant__burg____.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;get_formants.praat&quot;</span><span class="p">)</span>

    <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">inputWavFN</span><span class="p">,</span>
        <span class="n">outputTxtFN</span><span class="p">,</span>
        <span class="n">stepSize</span><span class="p">,</span>
        <span class="n">maxFormant</span><span class="p">,</span>
        <span class="n">window_length</span><span class="p">,</span>
        <span class="n">preemphasis</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="c1"># Load the output</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputTxtFN</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fn</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">csvFile</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csvFile</span><span class="p">]</span>

    <span class="c1"># The new praat script includes a header</span>
    <span class="k">if</span> <span class="n">dataList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
        <span class="n">dataList</span> <span class="o">=</span> <span class="n">dataList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># Handle undefined values, convert values to float</span>
    <span class="n">returnList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataList</span><span class="p">:</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;--&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">undefinedValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">undefinedValue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keep</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">keep</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">returnList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">returnList</span>


<span class="k">def</span> <span class="nf">getPulses</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputPointTierFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">data_points</span><span class="o">.</span><span class="n">PointObject1D</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the pitch/glottal pulses for an audio file.</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    http://www.fon.hum.uva.nl/praat/manual/Sound___Pitch__To_PointProcess__peaks____.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;get_pulses.praat&quot;</span><span class="p">)</span>

    <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span><span class="n">inputWavFN</span><span class="p">,</span> <span class="n">outputPointTierFN</span><span class="p">,</span> <span class="n">minPitch</span><span class="p">,</span> <span class="n">maxPitch</span><span class="p">]</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="c1"># Load the output</span>
    <span class="n">pointObj</span> <span class="o">=</span> <span class="n">data_points</span><span class="o">.</span><span class="n">open1DPointObject</span><span class="p">(</span><span class="n">outputPointTierFN</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pointObj</span>


<span class="k">def</span> <span class="nf">getSpectralInfo</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputTGFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputCSVFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">spectralPower</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">spectralMoment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts various spectral measures from an audio file</span>

<span class="sd">    Measures include: center_of_gravity, standard_deviation</span>
<span class="sd">    skewness, kertosis, central_movement</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    http://www.fon.hum.uva.nl/praat/manual/Spectrum.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;get_spectral_info.praat&quot;</span><span class="p">)</span>

    <span class="n">argList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">inputWavFN</span><span class="p">,</span>
        <span class="n">inputTGFN</span><span class="p">,</span>
        <span class="n">outputCSVFN</span><span class="p">,</span>
        <span class="n">tierName</span><span class="p">,</span>
        <span class="n">spectralPower</span><span class="p">,</span>
        <span class="n">spectralMoment</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span><span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>

    <span class="c1"># Load the output</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outputCSVFN</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">dataList</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dataListOfLists</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataList</span><span class="p">]</span>
    <span class="n">titleRow</span><span class="p">,</span> <span class="n">mainDataListOfLists</span> <span class="o">=</span> <span class="n">dataListOfLists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dataListOfLists</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">titleRow</span><span class="p">,</span> <span class="n">mainDataListOfLists</span>


<span class="k">def</span> <span class="nf">resynthesizePitch</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pitchFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pointList</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resynthesizes the pitch in a wav file with the given pitch contour file</span>

<span class="sd">    The pitch track to use can optionally be passed in as pointList.  If</span>
<span class="sd">    so, it will be saved as pitchFN for praat to be able to use.</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Manipulation.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;resynthesize_pitch.praat&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pointList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dur</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">WavQueryObj</span><span class="p">(</span><span class="n">inputWavFN</span><span class="p">)</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>
        <span class="n">pointObj</span> <span class="o">=</span> <span class="n">data_points</span><span class="o">.</span><span class="n">PointObject2D</span><span class="p">(</span>
            <span class="n">pointList</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DataPointTypes</span><span class="o">.</span><span class="n">PITCH</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dur</span>
        <span class="p">)</span>
        <span class="n">pointObj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pitchFN</span><span class="p">)</span>

    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span>
        <span class="n">praatEXE</span><span class="p">,</span> <span class="n">scriptFN</span><span class="p">,</span> <span class="p">[</span><span class="n">inputWavFN</span><span class="p">,</span> <span class="n">pitchFN</span><span class="p">,</span> <span class="n">outputWavFN</span><span class="p">,</span> <span class="n">minPitch</span><span class="p">,</span> <span class="n">maxPitch</span><span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">resynthesizeDuration</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">durationTierFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputWavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxPitch</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resynthesizes the duration in a wav file with the given duration tier</span>

<span class="sd">    Uses the following praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Manipulation.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;resynthesize_duration.praat&quot;</span><span class="p">)</span>

    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span>
        <span class="n">praatEXE</span><span class="p">,</span>
        <span class="n">scriptFN</span><span class="p">,</span>
        <span class="p">[</span><span class="n">inputWavFN</span><span class="p">,</span> <span class="n">durationTierFN</span><span class="p">,</span> <span class="n">outputWavFN</span><span class="p">,</span> <span class="n">minPitch</span><span class="p">,</span> <span class="n">maxPitch</span><span class="p">],</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">annotateSilences</span><span class="p">(</span>
    <span class="n">praatEXE</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputWavPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputTGPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">minPitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">timeStep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">silenceThreshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">25.0</span><span class="p">,</span>
    <span class="n">minSilDur</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">minSoundDur</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">silentLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SILENCE_LABEL</span><span class="p">,</span>
    <span class="n">soundLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SOUND_LABEL</span><span class="p">,</span>
    <span class="n">scriptFN</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Marks the silences and non-silences of an audio file</span>

<span class="sd">    Uses the praat command:</span>
<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/Sound__To_TextGrid__silences____.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scriptFN</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scriptFN</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s2">&quot;annotate_silences.praat&quot;</span><span class="p">)</span>

    <span class="n">utils</span><span class="o">.</span><span class="n">runPraatScript</span><span class="p">(</span>
        <span class="n">praatEXE</span><span class="p">,</span>
        <span class="n">scriptFN</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">inputWavPath</span><span class="p">,</span>
            <span class="n">outputTGPath</span><span class="p">,</span>
            <span class="n">minPitch</span><span class="p">,</span>
            <span class="n">timeStep</span><span class="p">,</span>
            <span class="n">silenceThreshold</span><span class="p">,</span>
            <span class="n">minSilDur</span><span class="p">,</span>
            <span class="n">minSoundDur</span><span class="p">,</span>
            <span class="n">silentLabel</span><span class="p">,</span>
            <span class="n">soundLabel</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Python wrappers for various praat scripts contained in /praatScripts.</p>

<p>see <strong>examples/auto_segment_speech.py</strong>, <strong>examples/get_pitch_and_formants.py</strong>,
<strong>klatt_resynthesis.py</strong></p>
</div>


                </section>
                <section id="praatio_scripts">
                                <div class="attr module"><a class="headerlink" href="#praatio_scripts">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/praatio_scripts.html">praatio.praatio_scripts</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Common/generic scripts or utilities that extend the functionality of praatio</span>

<span class="sd">see **examples/correct_misaligned_tiers.py**, **examples/delete_vowels.py**,</span>
<span class="sd">**examples/extract_subwavs.py**, **examples/splice_example.py**.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Final</span>

<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">textgrid</span>
<span class="kn">from</span> <span class="nn">praatio</span> <span class="kn">import</span> <span class="n">audio</span>
<span class="kn">from</span> <span class="nn">praatio.data_classes</span> <span class="kn">import</span> <span class="n">textgrid_tier</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">praatio.utilities.constants</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Interval</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">errors</span>


<span class="k">class</span> <span class="nc">NameStyle</span><span class="p">:</span>
    <span class="n">APPEND</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
    <span class="n">APPEND_NO_I</span> <span class="o">=</span> <span class="s2">&quot;append_no_i&quot;</span>
    <span class="n">LABEL</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>


<span class="k">def</span> <span class="nf">_shiftTimes</span><span class="p">(</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">,</span> <span class="n">timeV</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">newTimeV</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change all instances of timeV in the textgrid to newTimeV</span>

<span class="sd">    These are meant to be small changes.  No checks are done to see</span>
<span class="sd">    if the new interval steps on other intervals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tg</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tierName</span> <span class="ow">in</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">:</span>
        <span class="n">tier</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tier</span><span class="p">,</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">IntervalTier</span><span class="p">):</span>
            <span class="n">entryList</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">entry</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">timeV</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">timeV</span>
            <span class="p">]</span>
            <span class="n">insertEntryList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entryList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">timeV</span><span class="p">:</span>
                    <span class="n">newStart</span><span class="p">,</span> <span class="n">newStop</span> <span class="o">=</span> <span class="n">newTimeV</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">timeV</span><span class="p">:</span>
                    <span class="n">newStart</span><span class="p">,</span> <span class="n">newStop</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newTimeV</span>
                <span class="n">tier</span><span class="o">.</span><span class="n">deleteEntry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="n">insertEntryList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">newStart</span><span class="p">,</span> <span class="n">newStop</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">insertEntryList</span><span class="p">:</span>
                <span class="n">tier</span><span class="o">.</span><span class="n">insertEntry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tier</span><span class="p">,</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">PointTier</span><span class="p">):</span>
            <span class="n">entryList</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">timeV</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entryList</span><span class="p">:</span>
                <span class="n">tier</span><span class="o">.</span><span class="n">deleteEntry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="n">tier</span><span class="o">.</span><span class="n">insertEntry</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">newTimeV</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">tg</span>


<span class="k">def</span> <span class="nf">audioSplice</span><span class="p">(</span>
    <span class="n">audioObj</span><span class="p">:</span> <span class="n">audio</span><span class="o">.</span><span class="n">WavObj</span><span class="p">,</span>
    <span class="n">spliceSegment</span><span class="p">:</span> <span class="n">audio</span><span class="o">.</span><span class="n">WavObj</span><span class="p">,</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">,</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">newLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">insertStart</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">insertStop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">alignToZeroCrossing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">audio</span><span class="o">.</span><span class="n">WavObj</span><span class="p">,</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splices a segment into an audio file and corresponding textgrid</span>

<span class="sd">    Args:</span>
<span class="sd">        audioObj (WavObj): the audio to splice into</span>
<span class="sd">        spliceSegment (WavObj): the audio segment that will be placed into a</span>
<span class="sd">            larger audio file</span>
<span class="sd">        tg (Textgrid): the textgrid to splice into</span>
<span class="sd">        tierName (str): the name of the tier that will receive the new label</span>
<span class="sd">        newLabel (str): the label for the splice interval on the tier with</span>
<span class="sd">            name tierName</span>
<span class="sd">        insertStart (float): the time to insert the splice</span>
<span class="sd">        insertStop (float): if not None, will erase the region between</span>
<span class="sd">            sourceSpStart and sourceSpEnd.  (In practice this means audioSplice</span>
<span class="sd">            removes one segment and inserts another in its place)</span>
<span class="sd">        alignToZeroCrossing - if True, moves all involved times to the nearest</span>
<span class="sd">            zero crossing in the audio.  Generally results</span>
<span class="sd">            in better sounding output</span>

<span class="sd">    Returns:</span>
<span class="sd">        [WavObj, Textgrid]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">retTG</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>

    <span class="c1"># Ensure all time points involved in splicing fall on zero crossings</span>
    <span class="k">if</span> <span class="n">alignToZeroCrossing</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

        <span class="c1"># Cut the splice segment to zero crossings</span>
        <span class="n">spliceDuration</span> <span class="o">=</span> <span class="n">spliceSegment</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>
        <span class="n">spliceZeroStart</span> <span class="o">=</span> <span class="n">spliceSegment</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">spliceZeroEnd</span> <span class="o">=</span> <span class="n">spliceSegment</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="n">spliceDuration</span><span class="p">)</span>
        <span class="n">spliceSegment</span> <span class="o">=</span> <span class="n">spliceSegment</span><span class="o">.</span><span class="n">getSubsegment</span><span class="p">(</span><span class="n">spliceZeroStart</span><span class="p">,</span> <span class="n">spliceZeroEnd</span><span class="p">)</span>

        <span class="c1"># Move the textgrid borders to zero crossings</span>
        <span class="n">oldInsertStart</span> <span class="o">=</span> <span class="n">insertStart</span>
        <span class="n">insertStart</span> <span class="o">=</span> <span class="n">audioObj</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="n">oldInsertStart</span><span class="p">)</span>
        <span class="n">retTG</span> <span class="o">=</span> <span class="n">_shiftTimes</span><span class="p">(</span><span class="n">retTG</span><span class="p">,</span> <span class="n">oldInsertStart</span><span class="p">,</span> <span class="n">insertStart</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">insertStop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">oldInsertStop</span> <span class="o">=</span> <span class="n">insertStop</span>
            <span class="n">insertStop</span> <span class="o">=</span> <span class="n">audioObj</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="n">oldInsertStop</span><span class="p">)</span>
            <span class="n">retTG</span> <span class="o">=</span> <span class="n">_shiftTimes</span><span class="p">(</span><span class="n">retTG</span><span class="p">,</span> <span class="n">oldInsertStop</span><span class="p">,</span> <span class="n">insertStop</span><span class="p">)</span>

    <span class="c1"># Get the start time</span>
    <span class="n">insertTime</span> <span class="o">=</span> <span class="n">insertStart</span>
    <span class="k">if</span> <span class="n">insertStop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">insertTime</span> <span class="o">=</span> <span class="n">insertStop</span>

    <span class="c1"># Insert into the audio file</span>
    <span class="n">audioObj</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertTime</span><span class="p">,</span> <span class="n">spliceSegment</span><span class="o">.</span><span class="n">audioSamples</span><span class="p">)</span>

    <span class="c1"># Insert a blank region into the textgrid on all tiers</span>
    <span class="n">targetDuration</span> <span class="o">=</span> <span class="n">spliceSegment</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>
    <span class="n">retTG</span> <span class="o">=</span> <span class="n">retTG</span><span class="o">.</span><span class="n">insertSpace</span><span class="p">(</span><span class="n">insertTime</span><span class="p">,</span> <span class="n">targetDuration</span><span class="p">,</span> <span class="s2">&quot;stretch&quot;</span><span class="p">)</span>

    <span class="c1"># Insert the splice entry into the target tier</span>
    <span class="n">newEntry</span> <span class="o">=</span> <span class="p">(</span><span class="n">insertTime</span><span class="p">,</span> <span class="n">insertTime</span> <span class="o">+</span> <span class="n">targetDuration</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">)</span>
    <span class="n">retTG</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span><span class="o">.</span><span class="n">insertEntry</span><span class="p">(</span><span class="n">newEntry</span><span class="p">)</span>

    <span class="c1"># Finally, delete the old section if requested</span>
    <span class="k">if</span> <span class="n">insertStop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">audioObj</span><span class="o">.</span><span class="n">deleteSegment</span><span class="p">(</span><span class="n">insertStart</span><span class="p">,</span> <span class="n">insertStop</span><span class="p">)</span>
        <span class="n">retTG</span> <span class="o">=</span> <span class="n">retTG</span><span class="o">.</span><span class="n">eraseRegion</span><span class="p">(</span><span class="n">insertStart</span><span class="p">,</span> <span class="n">insertStop</span><span class="p">,</span> <span class="n">doShrink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">audioObj</span><span class="p">,</span> <span class="n">retTG</span>


<span class="k">def</span> <span class="nf">spellCheckEntries</span><span class="p">(</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">,</span>
    <span class="n">targetTierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">newTierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">checkFunction</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span>
    <span class="n">printEntries</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spell checks words in a textgrid</span>

<span class="sd">    Entries can contain one or more words, separated by whitespace.</span>
<span class="sd">    If a mispelling is found, it is noted in a special tier and optionally</span>
<span class="sd">    printed to the screen.</span>

<span class="sd">    checkFunction is user-defined.  It takes a word and returns True if it is</span>
<span class="sd">    spelled correctly and false if not. There are robust spell check libraries</span>
<span class="sd">    for python like woosh or pyenchant.  I have already written a naive</span>
<span class="sd">    spell checker in the pysle.praattools library.</span>

<span class="sd">    checkFunction: should return True if a word is spelled correctly and</span>
<span class="sd">                   False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">punctuationList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;_&quot;</span><span class="p">,</span>
        <span class="s2">&quot;,&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;;&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">tg</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="n">tier</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">targetTierName</span><span class="p">]</span>

    <span class="n">mispelledEntryList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>

        <span class="c1"># Remove punctuation</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">punctuationList</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">wordList</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">mispelledList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wordList</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">checkFunction</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
                <span class="n">mispelledList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mispelledList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mispelledTxt</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mispelledList</span><span class="p">)</span>
            <span class="n">mispelledEntryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Interval</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mispelledTxt</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">printEntries</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mispelledTxt</span><span class="p">))</span>

    <span class="n">tier</span> <span class="o">=</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">IntervalTier</span><span class="p">(</span>
        <span class="n">newTierName</span><span class="p">,</span> <span class="n">mispelledEntryList</span><span class="p">,</span> <span class="n">tg</span><span class="o">.</span><span class="n">minTimestamp</span><span class="p">,</span> <span class="n">tg</span><span class="o">.</span><span class="n">maxTimestamp</span>
    <span class="p">)</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">tier</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tg</span>


<span class="k">def</span> <span class="nf">splitTierEntries</span><span class="p">(</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">,</span>
    <span class="n">sourceTierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">targetTierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">startT</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">endT</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split each entry in a tier by space</span>

<span class="sd">    The split entries will be placed on a new tier.  The split entries</span>
<span class="sd">    are equally allocated a subsegment of the interval occupied by the</span>
<span class="sd">    source tier.  e.g. [(63, 66, &#39;the blue cat&#39;), ] would become</span>
<span class="sd">    [(63, 64, &#39;the&#39;), (64, 65, &#39;blue&#39;), (65, 66, &#39;cat&#39;), ]</span>

<span class="sd">    This could be used to decompose utterances into words or, with pysle,</span>
<span class="sd">    words into phones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">minT</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">minTimestamp</span>
    <span class="n">maxT</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">maxTimestamp</span>

    <span class="n">sourceTier</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">sourceTierName</span><span class="p">]</span>
    <span class="n">targetTier</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Examine a subset of the source tier?</span>
    <span class="k">if</span> <span class="n">startT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">endT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">startT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">startT</span> <span class="o">=</span> <span class="n">minT</span>
        <span class="k">if</span> <span class="n">endT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endT</span> <span class="o">=</span> <span class="n">maxT</span>

        <span class="n">sourceTier</span> <span class="o">=</span> <span class="n">sourceTier</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">startT</span><span class="p">,</span> <span class="n">endT</span><span class="p">,</span> <span class="s2">&quot;truncated&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">targetTierName</span> <span class="ow">in</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">:</span>
            <span class="n">targetTier</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">targetTierName</span><span class="p">]</span>
            <span class="n">targetTier</span> <span class="o">=</span> <span class="n">targetTier</span><span class="o">.</span><span class="n">eraseRegion</span><span class="p">(</span><span class="n">startT</span><span class="p">,</span> <span class="n">endT</span><span class="p">,</span> <span class="s2">&quot;truncate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Split the entries in the source tier</span>
    <span class="n">newEntryList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">sourceTier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>
        <span class="n">labelList</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">intervalLength</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labelList</span><span class="p">))</span>

        <span class="n">newSubEntryList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Interval</span><span class="p">(</span>
                <span class="n">start</span> <span class="o">+</span> <span class="n">intervalLength</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">intervalLength</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">label</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labelList</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">newEntryList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">newSubEntryList</span><span class="p">)</span>

    <span class="c1"># Create a new tier</span>
    <span class="k">if</span> <span class="n">targetTier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">targetTier</span> <span class="o">=</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">IntervalTier</span><span class="p">(</span><span class="n">targetTierName</span><span class="p">,</span> <span class="n">newEntryList</span><span class="p">,</span> <span class="n">minT</span><span class="p">,</span> <span class="n">maxT</span><span class="p">)</span>

    <span class="c1"># Or insert new entries into existing target tier</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">newEntryList</span><span class="p">:</span>
            <span class="n">targetTier</span><span class="o">.</span><span class="n">insertEntry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">IntervalCollision</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

    <span class="c1"># Insert the tier into the textgrid</span>
    <span class="k">if</span> <span class="n">targetTierName</span> <span class="ow">in</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">:</span>
        <span class="n">tg</span><span class="o">.</span><span class="n">removeTier</span><span class="p">(</span><span class="n">targetTierName</span><span class="p">)</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">targetTier</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tg</span>


<span class="k">def</span> <span class="nf">tgBoundariesToZeroCrossings</span><span class="p">(</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">,</span>
    <span class="n">wavObj</span><span class="p">:</span> <span class="n">audio</span><span class="o">.</span><span class="n">WavObj</span><span class="p">,</span>
    <span class="n">adjustPointTiers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">adjustIntervalTiers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes all textgrid interval boundaries fall on pressure wave zero crossings</span>

<span class="sd">    adjustPointTiers: if True, point tiers will be adjusted.</span>
<span class="sd">    adjustIntervalTiers: if True, interval tiers will be adjusted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">tierName</span> <span class="ow">in</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">[:]:</span>
        <span class="n">tier</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span>

        <span class="n">newTier</span><span class="p">:</span> <span class="n">textgrid_tier</span><span class="o">.</span><span class="n">TextgridTier</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tier</span><span class="p">,</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">PointTier</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">adjustPointTiers</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>
                <span class="n">newStart</span> <span class="o">=</span> <span class="n">wavObj</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">newStart</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
            <span class="n">newTier</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">entryList</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tier</span><span class="p">,</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">IntervalTier</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">adjustIntervalTiers</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>
                <span class="n">newStart</span> <span class="o">=</span> <span class="n">wavObj</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="n">newStop</span> <span class="o">=</span> <span class="n">wavObj</span><span class="o">.</span><span class="n">findNearestZeroCrossing</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
                <span class="n">intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Interval</span><span class="p">(</span><span class="n">newStart</span><span class="p">,</span> <span class="n">newStop</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
            <span class="n">newTier</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">entryList</span><span class="o">=</span><span class="n">intervals</span><span class="p">)</span>

        <span class="n">tg</span><span class="o">.</span><span class="n">replaceTier</span><span class="p">(</span><span class="n">tierName</span><span class="p">,</span> <span class="n">newTier</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tg</span>


<span class="k">def</span> <span class="nf">splitAudioOnTier</span><span class="p">(</span>
    <span class="n">wavFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tgFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outputTGFlag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">nameStyle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="s2">&quot;append_no_i&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">noPartialIntervals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">silenceLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Outputs one subwav for each entry in the tier of a textgrid</span>

<span class="sd">    Args:</span>
<span class="sd">        wavnFN (str):</span>
<span class="sd">        tgFN (str):</span>
<span class="sd">        tierName (str):</span>
<span class="sd">        outputPath (str):</span>
<span class="sd">        outputTGFlag (bool): If True, outputs paired, cropped textgrids</span>
<span class="sd">            If is type str (a tier name), outputs a paired, cropped</span>
<span class="sd">            textgrid with only the specified tier</span>
<span class="sd">        nameStyle (str):</span>
<span class="sd">            - &#39;append&#39;: append interval label to output name</span>
<span class="sd">            - &#39;append_no_i&#39;: append label but not interval to output name</span>
<span class="sd">            - &#39;label&#39;: output name is the same as label</span>
<span class="sd">            - None: output name plus the interval number</span>
<span class="sd">        noPartialIntervals (bool): if True: intervals in non-target tiers that</span>
<span class="sd">            are not wholly contained by an interval in the target tier will not</span>
<span class="sd">            be included in the output textgrids</span>
<span class="sd">        silenceLabel (str): the label for silent regions.  If silences are</span>
<span class="sd">            unlabeled intervals (i.e. blank) then leave this alone.  If</span>
<span class="sd">            silences are labeled using praat&#39;s &quot;annotate &gt;&gt; to silences&quot;</span>
<span class="sd">            then this value should be &quot;silences&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputPath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">myBool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="s2">&quot;lax&quot;</span><span class="p">,</span> <span class="s2">&quot;truncated&quot;</span><span class="p">]:</span>
        <span class="c1"># This will make mypy happy</span>
        <span class="k">if</span> <span class="n">myBool</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">CropCollision</span><span class="o">.</span><span class="n">STRICT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">CropCollision</span><span class="o">.</span><span class="n">TRUNCATED</span>

    <span class="n">mode</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">getValue</span><span class="p">(</span><span class="n">noPartialIntervals</span><span class="p">)</span>

    <span class="n">tg</span> <span class="o">=</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">openTextgrid</span><span class="p">(</span><span class="n">tgFN</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">entryList</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span><span class="o">.</span><span class="n">entryList</span>

    <span class="k">if</span> <span class="n">silenceLabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entryList</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entryList</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">silenceLabel</span><span class="p">]</span>

    <span class="c1"># Build the output name template</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">wavFN</span><span class="p">)[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">orderOfMagnitude</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">entryList</span><span class="p">))))</span>

    <span class="c1"># We want one more zero in the output than the order of magnitude</span>
    <span class="n">outputTemplate</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%%</span><span class="s2">0</span><span class="si">%d</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">orderOfMagnitude</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">firstWarning</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If we&#39;re using the &#39;label&#39; namestyle for outputs, all of the</span>
    <span class="c1"># interval labels have to be unique, or wave files with those</span>
    <span class="c1"># labels as names, will be overwritten</span>
    <span class="k">if</span> <span class="n">nameStyle</span> <span class="o">==</span> <span class="n">NameStyle</span><span class="o">.</span><span class="n">LABEL</span><span class="p">:</span>
        <span class="n">wordList</span> <span class="o">=</span> <span class="p">[</span><span class="n">interval</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">entryList</span><span class="p">]</span>
        <span class="n">multipleInstList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">wordList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">wordList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">multipleInstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multipleInstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">instListTxt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">multipleInstList</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Overwriting wave files in: </span><span class="si">{</span><span class="n">outputPath</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Intervals exist with the same name:</span><span class="se">\n</span><span class="si">{</span><span class="n">instListTxt</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">firstWarning</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Output wave files</span>
    <span class="n">outputFNList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wavQObj</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">WavQueryObj</span><span class="p">(</span><span class="n">wavFN</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">entryList</span><span class="p">):</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="c1"># Resolve output name</span>
        <span class="k">if</span> <span class="n">nameStyle</span> <span class="o">==</span> <span class="n">NameStyle</span><span class="o">.</span><span class="n">APPEND_NO_I</span><span class="p">:</span>
            <span class="n">outputName</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">nameStyle</span> <span class="o">==</span> <span class="n">NameStyle</span><span class="o">.</span><span class="n">LABEL</span><span class="p">:</span>
            <span class="n">outputName</span> <span class="o">=</span> <span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputName</span> <span class="o">=</span> <span class="n">outputTemplate</span> <span class="o">%</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">nameStyle</span> <span class="o">==</span> <span class="n">NameStyle</span><span class="o">.</span><span class="n">APPEND</span><span class="p">:</span>
                <span class="n">outputName</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">outputFNFullPath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">outputName</span> <span class="o">+</span> <span class="s2">&quot;.wav&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFNFullPath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">firstWarning</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Overwriting wave files in: </span><span class="si">{</span><span class="n">outputPath</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Files existed before or intervals exist with &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the same name:</span><span class="se">\n</span><span class="si">{</span><span class="n">outputName</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="n">wavQObj</span><span class="o">.</span><span class="n">getFrames</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">wavQObj</span><span class="o">.</span><span class="n">outputModifiedWav</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">outputFNFullPath</span><span class="p">)</span>

        <span class="n">outputFNList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">outputName</span> <span class="o">+</span> <span class="s2">&quot;.wav&quot;</span><span class="p">))</span>

        <span class="c1"># Output the textgrid if requested</span>
        <span class="k">if</span> <span class="n">outputTGFlag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">subTG</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outputTGFlag</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">tierName</span> <span class="ow">in</span> <span class="n">subTG</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tierName</span> <span class="o">!=</span> <span class="n">outputTGFlag</span><span class="p">:</span>
                        <span class="n">subTG</span><span class="o">.</span><span class="n">removeTier</span><span class="p">(</span><span class="n">tierName</span><span class="p">)</span>

            <span class="n">subTG</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">outputName</span> <span class="o">+</span> <span class="s2">&quot;.TextGrid&quot;</span><span class="p">),</span> <span class="s2">&quot;short_textgrid&quot;</span><span class="p">,</span> <span class="kc">True</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">outputFNList</span>


<span class="k">def</span> <span class="nf">alignBoundariesAcrossTiers</span><span class="p">(</span>
    <span class="n">tgFN</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">maxDifference</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aligns boundaries or points in a textgrid that suffer from &#39;jitter&#39;</span>

<span class="sd">    Often times, boundaries in different tiers are meant to line up.</span>
<span class="sd">    For example the boundary of the first phone in a word and the start</span>
<span class="sd">    of the word.  If manually annotated, however, those values might</span>
<span class="sd">    not be the same, even if they were intended to be the same.</span>

<span class="sd">    This script will force all boundaries within /maxDifference/ amount</span>
<span class="sd">    to be the same value.  The replacement value is either the majority</span>
<span class="sd">    value found within /maxDifference/ or, if no majority exists, than</span>
<span class="sd">    the value used in the search query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tg</span> <span class="o">=</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">openTextgrid</span><span class="p">(</span><span class="n">tgFN</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">tierName</span> <span class="ow">in</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierNameList</span><span class="p">:</span>
        <span class="n">altNameList</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmpName</span> <span class="k">for</span> <span class="n">tmpName</span> <span class="ow">in</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierNameList</span> <span class="k">if</span> <span class="n">tmpName</span> <span class="o">!=</span> <span class="n">tierName</span><span class="p">]</span>

        <span class="n">tier</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>
            <span class="c1"># Interval tier left boundary or point tier point</span>
            <span class="n">_findMisalignments</span><span class="p">(</span>
                <span class="n">tg</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxDifference</span><span class="p">,</span> <span class="n">altNameList</span><span class="p">,</span> <span class="n">tierName</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="mi">0</span>
            <span class="p">)</span>

        <span class="c1"># Interval tier right boundary</span>
        <span class="k">if</span> <span class="n">tier</span><span class="o">.</span><span class="n">tierType</span> <span class="o">==</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">INTERVAL_TIER</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>
                <span class="n">_findMisalignments</span><span class="p">(</span>
                    <span class="n">tg</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxDifference</span><span class="p">,</span> <span class="n">altNameList</span><span class="p">,</span> <span class="n">tierName</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="mi">1</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">tg</span>


<span class="k">def</span> <span class="nf">_findMisalignments</span><span class="p">(</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">Textgrid</span><span class="p">,</span>
    <span class="n">timeV</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">maxDifference</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tierNameList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">tierName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">entry</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">orderID</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is just used by alignBoundariesAcrossTiers()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the start time</span>
    <span class="n">filterStartT</span> <span class="o">=</span> <span class="n">timeV</span> <span class="o">-</span> <span class="n">maxDifference</span>
    <span class="k">if</span> <span class="n">filterStartT</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">filterStartT</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Get the end time</span>
    <span class="n">filterStopT</span> <span class="o">=</span> <span class="n">timeV</span> <span class="o">+</span> <span class="n">maxDifference</span>
    <span class="k">if</span> <span class="n">filterStopT</span> <span class="o">&gt;</span> <span class="n">tg</span><span class="o">.</span><span class="n">maxTimestamp</span><span class="p">:</span>
        <span class="n">filterStopT</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">maxTimestamp</span>

    <span class="n">croppedTG</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">filterStartT</span><span class="p">,</span> <span class="n">filterStopT</span><span class="p">,</span> <span class="s2">&quot;lax&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">matchList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tierName</span><span class="p">,</span> <span class="n">timeV</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">orderID</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">subTierName</span> <span class="ow">in</span> <span class="n">tierNameList</span><span class="p">:</span>
        <span class="n">subCroppedTier</span> <span class="o">=</span> <span class="n">croppedTG</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">subTierName</span><span class="p">]</span>

        <span class="c1"># For each item that exists in the search span, find the boundary</span>
        <span class="c1"># that lies in the search span</span>
        <span class="k">for</span> <span class="n">subCroppedEntry</span> <span class="ow">in</span> <span class="n">subCroppedTier</span><span class="o">.</span><span class="n">entryList</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">subCroppedTier</span><span class="o">.</span><span class="n">tierType</span> <span class="o">==</span> <span class="n">textgrid</span><span class="o">.</span><span class="n">INTERVAL_TIER</span><span class="p">:</span>
                <span class="n">subStart</span><span class="p">,</span> <span class="n">subEnd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">subCroppedEntry</span>

                <span class="c1"># Left boundary?</span>
                <span class="n">leftMatchVal</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">subStart</span> <span class="o">&gt;=</span> <span class="n">filterStartT</span> <span class="ow">and</span> <span class="n">subStart</span> <span class="o">&lt;=</span> <span class="n">filterStopT</span><span class="p">:</span>
                    <span class="n">leftMatchVal</span> <span class="o">=</span> <span class="n">subStart</span>

                <span class="c1"># Right boundary?</span>
                <span class="n">rightMatchVal</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">subEnd</span> <span class="o">&gt;=</span> <span class="n">filterStartT</span> <span class="ow">and</span> <span class="n">subEnd</span> <span class="o">&lt;=</span> <span class="n">filterStopT</span><span class="p">:</span>
                    <span class="n">rightMatchVal</span> <span class="o">=</span> <span class="n">subEnd</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">leftMatchVal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rightMatchVal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># This shouldn&#39;t happen</span>
                    <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UnexpectedError</span><span class="p">(</span>
                        <span class="s2">&quot;There should be at most one matching boundary.&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Set the matching boundary info</span>
                <span class="k">if</span> <span class="n">leftMatchVal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">matchVal</span> <span class="o">=</span> <span class="n">leftMatchVal</span>
                    <span class="n">subOrderID</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">matchVal</span> <span class="o">=</span> <span class="n">rightMatchVal</span>
                    <span class="n">subOrderID</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># Match value could be none if, for an interval tier,</span>
                <span class="c1"># no boundary sits inside the search span (the search span</span>
                <span class="c1"># is wholly inside the interval)</span>
                <span class="k">if</span> <span class="n">matchVal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">subCroppedTier</span><span class="o">.</span><span class="n">tierType</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">POINT_TIER</span><span class="p">:</span>
                <span class="n">subStart</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">subCroppedEntry</span>
                <span class="k">if</span> <span class="n">subStart</span> <span class="o">&gt;=</span> <span class="n">filterStartT</span> <span class="ow">and</span> <span class="n">subStart</span> <span class="o">&lt;=</span> <span class="n">filterStopT</span><span class="p">:</span>
                    <span class="n">matchVal</span> <span class="o">=</span> <span class="n">subStart</span>
                    <span class="n">subOrderID</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">matchList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">subTierName</span><span class="p">,</span> <span class="n">matchVal</span><span class="p">,</span> <span class="n">subCroppedEntry</span><span class="p">,</span> <span class="n">subOrderID</span><span class="p">))</span>

    <span class="c1"># Find the number of different values that are almost the same</span>
    <span class="n">valList</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matchList</span><span class="p">]</span>
    <span class="n">valUniqueList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">valList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valUniqueList</span><span class="p">:</span>
            <span class="n">valUniqueList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="c1"># If they&#39;re all the same, there is nothing to do</span>
    <span class="c1"># If some are different, take the most common value (or else the first</span>
    <span class="c1"># one) and set all similar times to that value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valUniqueList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">countList</span> <span class="o">=</span> <span class="p">[</span><span class="n">valList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">valUniqueList</span><span class="p">]</span>
        <span class="n">bestVal</span> <span class="o">=</span> <span class="n">valUniqueList</span><span class="p">[</span><span class="n">countList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">countList</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">bestVal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># When can this happen?</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UnexpectedError</span><span class="p">(</span><span class="s2">&quot;Could not find the optimal value&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tierName</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">oldEntry</span><span class="p">,</span> <span class="n">orderID</span> <span class="ow">in</span> <span class="n">matchList</span><span class="p">:</span>

            <span class="n">newEntry</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">oldEntry</span><span class="p">))</span>
            <span class="n">newEntry</span><span class="p">[</span><span class="n">orderID</span><span class="p">]</span> <span class="o">=</span> <span class="n">bestVal</span>
            <span class="n">castNewEntry</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span><span class="o">.</span><span class="n">entryType</span><span class="p">(</span><span class="o">*</span><span class="n">newEntry</span><span class="p">)</span>

            <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span><span class="o">.</span><span class="n">deleteEntry</span><span class="p">(</span><span class="n">oldEntry</span><span class="p">)</span>
            <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span><span class="o">.</span><span class="n">entryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">castNewEntry</span><span class="p">)</span>
            <span class="n">tg</span><span class="o">.</span><span class="n">tierDict</span><span class="p">[</span><span class="n">tierName</span><span class="p">]</span><span class="o">.</span><span class="n">entryList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Common/generic scripts or utilities that extend the functionality of praatio</p>

<p>see <strong>examples/correct_misaligned_tiers.py</strong>, <strong>examples/delete_vowels.py</strong>,
<strong>examples/extract_subwavs.py</strong>, <strong>examples/splice_example.py</strong>.</p>
</div>


                </section>
                <section id="textgrid">
                                <div class="attr module"><a class="headerlink" href="#textgrid">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/textgrid.html">praatio.textgrid</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions for reading/writing/manipulating textgrid files.</span>

<span class="sd">This file links the main data structures for representing Textgrid data:</span>
<span class="sd">Textgrid, IntervalTier, and PointTier</span>

<span class="sd">A Textgrid is a container for multiple annotation tiers.  Tiers can contain</span>
<span class="sd">either interval data (IntervalTier) or point data (PointTier).</span>
<span class="sd">Tiers in a Textgrid are ordered and must contain a unique name.</span>

<span class="sd">openTextgrid() can be used to open a textgrid file.</span>
<span class="sd">Textgrid.save() can be used to save a Textgrid object to a file.</span>

<span class="sd">Historically, these three classes lived in this file. To</span>
<span class="sd">make maintance easier, they were split off.  You can still access</span>
<span class="sd">them from this file as before, but please check out the respective</span>
<span class="sd">files for more documentation on each class:</span>
<span class="sd">IntervalTier in data_classes/interval_tier.py</span>
<span class="sd">PointTier in data_classes/point_tier.py</span>
<span class="sd">Textgrid in data_classes/textgrid.py</span>

<span class="sd">see the **examples/** directory for examples using textgrid.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>


<span class="kn">from</span> <span class="nn">praatio.utilities.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">INTERVAL_TIER</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">praatio.data_classes.interval_tier</span> <span class="kn">import</span> <span class="n">IntervalTier</span>
<span class="kn">from</span> <span class="nn">praatio.data_classes.point_tier</span> <span class="kn">import</span> <span class="n">PointTier</span>
<span class="kn">from</span> <span class="nn">praatio.data_classes.textgrid</span> <span class="kn">import</span> <span class="n">Textgrid</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">textgrid_io</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">praatio.utilities</span> <span class="kn">import</span> <span class="n">errors</span>


<span class="k">def</span> <span class="nf">openTextgrid</span><span class="p">(</span>
    <span class="n">fnFullPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">includeEmptyIntervals</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">reportingMode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;silence&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
    <span class="n">duplicateNamesMode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;rename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens a textgrid file (.TextGrid and .json are both fine)</span>

<span class="sd">    Args:</span>
<span class="sd">        fnFullPath (str): the path to the textgrid to open</span>
<span class="sd">        includeEmptyIntervals (bool): if False, points and intervals with</span>
<span class="sd">             an empty label &#39;&#39; are not included in the returned Textgrid</span>

<span class="sd">    Returns:</span>
<span class="sd">        Textgrid</span>

<span class="sd">    https://www.fon.hum.uva.nl/praat/manual/TextGrid_file_formats.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">validateOption</span><span class="p">(</span><span class="s2">&quot;reportingMode&quot;</span><span class="p">,</span> <span class="n">reportingMode</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">ErrorReportingMode</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">validateOption</span><span class="p">(</span>
        <span class="s2">&quot;duplicateNamesMode&quot;</span><span class="p">,</span> <span class="n">duplicateNamesMode</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">DuplicateNames</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fnFullPath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-16&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fnFullPath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">tgAsDict</span> <span class="o">=</span> <span class="n">textgrid_io</span><span class="o">.</span><span class="n">parseTextgridStr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">includeEmptyIntervals</span><span class="p">)</span>

    <span class="n">tierNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tier</span> <span class="ow">in</span> <span class="n">tgAsDict</span><span class="p">[</span><span class="s2">&quot;tiers&quot;</span><span class="p">]:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tier</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tierNames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">duplicateNamesMode</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">DuplicateNames</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DuplicateTierName</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your textgrid contains tiers with the same name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="s2">&quot;This is not allowed. It is recommended that you rename them. &quot;</span>
                    <span class="s2">&quot;If you set openTextgrid(..., duplicateNamesMode=&#39;rename&#39;), praatio &quot;</span>
                    <span class="s2">&quot;will automatically append numbers to the end of tiers to ensure they &quot;</span>
                    <span class="s2">&quot;are unique.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">duplicateNamesMode</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">DuplicateNames</span><span class="o">.</span><span class="n">RENAME</span><span class="p">:</span>
                <span class="n">newName</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">while</span> <span class="n">newName</span> <span class="ow">in</span> <span class="n">tierNames</span><span class="p">:</span>
                    <span class="n">newName</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">newName</span>
                <span class="n">tier</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">tierNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_dictionaryToTg</span><span class="p">(</span><span class="n">tgAsDict</span><span class="p">,</span> <span class="n">reportingMode</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_dictionaryToTg</span><span class="p">(</span>
    <span class="n">tgAsDict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reportingMode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;silence&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Textgrid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Converts a dictionary representation of a textgrid to a Textgrid&quot;&quot;&quot;</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">validateOption</span><span class="p">(</span><span class="s2">&quot;reportingMode&quot;</span><span class="p">,</span> <span class="n">reportingMode</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">ErrorReportingMode</span><span class="p">)</span>

    <span class="n">tg</span> <span class="o">=</span> <span class="n">Textgrid</span><span class="p">()</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">minTimestamp</span> <span class="o">=</span> <span class="n">tgAsDict</span><span class="p">[</span><span class="s2">&quot;xmin&quot;</span><span class="p">]</span>
    <span class="n">tg</span><span class="o">.</span><span class="n">maxTimestamp</span> <span class="o">=</span> <span class="n">tgAsDict</span><span class="p">[</span><span class="s2">&quot;xmax&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">tierAsDict</span> <span class="ow">in</span> <span class="n">tgAsDict</span><span class="p">[</span><span class="s2">&quot;tiers&quot;</span><span class="p">]:</span>
        <span class="n">klass</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">PointTier</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">IntervalTier</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">tierAsDict</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">INTERVAL_TIER</span><span class="p">:</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="n">IntervalTier</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">klass</span> <span class="o">=</span> <span class="n">PointTier</span>
        <span class="n">tier</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span>
            <span class="n">tierAsDict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">tierAsDict</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">],</span>
            <span class="n">tierAsDict</span><span class="p">[</span><span class="s2">&quot;xmin&quot;</span><span class="p">],</span>
            <span class="n">tierAsDict</span><span class="p">[</span><span class="s2">&quot;xmax&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">tg</span><span class="o">.</span><span class="n">addTier</span><span class="p">(</span><span class="n">tier</span><span class="p">,</span> <span class="n">reportingMode</span><span class="o">=</span><span class="n">reportingMode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tg</span>
</pre></div>

        </details>

            <div class="docstring"><p>Functions for reading/writing/manipulating textgrid files.</p>

<p>This file links the main data structures for representing Textgrid data:
Textgrid, IntervalTier, and PointTier</p>

<p>A Textgrid is a container for multiple annotation tiers.  Tiers can contain
either interval data (IntervalTier) or point data (PointTier).
Tiers in a Textgrid are ordered and must contain a unique name.</p>

<p>openTextgrid() can be used to open a textgrid file.
Textgrid.save() can be used to save a Textgrid object to a file.</p>

<p>Historically, these three classes lived in this file. To
make maintance easier, they were split off.  You can still access
them from this file as before, but please check out the respective
files for more documentation on each class:
IntervalTier in data_classes/interval_tier.py
PointTier in data_classes/point_tier.py
Textgrid in data_classes/textgrid.py</p>

<p>see the <strong>examples/</strong> directory for examples using textgrid.py</p>
</div>


                </section>
                <section id="data_classes">
                                <div class="attr module"><a class="headerlink" href="#data_classes">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/data_classes.html">praatio.data_classes</a></span></div>

        
    

                </section>
                <section id="utilities">
                                <div class="attr module"><a class="headerlink" href="#utilities">#&nbsp;&nbsp</a>
<span class="name"><a href="praatio/utilities.html">praatio.utilities</a></span></div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Various os, math, and language-related utilities.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>Various os, math, and language-related utilities.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">(${doc.parameters.join(", ")})</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>